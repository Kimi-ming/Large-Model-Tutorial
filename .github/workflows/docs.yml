name: Documentation

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  build-docs:
    name: Build Documentation
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
    
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        # æ–‡æ¡£å·¥å…·ï¼ˆå¦‚éœ€è¦MkDocsç­‰ï¼‰
        # pip install mkdocs mkdocs-material
    
    - name: Check Markdown files
      run: |
        # æ£€æŸ¥Markdownæ–‡ä»¶æ ¼å¼
        find docs/ -name "*.md" -type f | while read file; do
          echo "Checking $file"
          # ç®€å•éªŒè¯ï¼šæ–‡ä»¶éç©º
          if [ ! -s "$file" ]; then
            echo "âŒ Empty file: $file"
            exit 1
          fi
        done
        echo "âœ… All Markdown files are valid"
    
    - name: Validate code blocks in docs
      run: |
        # éªŒè¯æ–‡æ¡£ä¸­çš„ä»£ç å—ï¼ˆPythonï¼‰
        python -c "
import re
from pathlib import Path

errors = []
for md_file in Path('docs').rglob('*.md'):
    content = md_file.read_text(encoding='utf-8')
    # æŸ¥æ‰¾Pythonä»£ç å—
    python_blocks = re.findall(r'\`\`\`python\n(.*?)\n\`\`\`', content, re.DOTALL)
    
    for i, block in enumerate(python_blocks):
        # ç®€å•éªŒè¯ï¼šæ£€æŸ¥æ˜¯å¦æœ‰æ˜æ˜¾çš„è¯­æ³•é”™è¯¯
        if 'import' in block and not block.strip().startswith('#'):
            try:
                compile(block, f'{md_file}:block_{i}', 'exec')
            except SyntaxError as e:
                errors.append(f'{md_file} block {i}: {e}')

if errors:
    print('âŒ Found syntax errors in code blocks:')
    for err in errors[:5]:  # åªæ˜¾ç¤ºå‰5ä¸ª
        print(f'  {err}')
    # ä¸é˜»æ–­æ„å»ºï¼Œä»…è­¦å‘Š
    print('âš ï¸ Code blocks have syntax issues (non-blocking)')
else:
    print('âœ… All Python code blocks are syntactically valid')
        "
      continue-on-error: true
    
    - name: Generate documentation structure
      run: |
        # ç”Ÿæˆæ–‡æ¡£ç›®å½•ç»“æ„
        echo "# Documentation Structure" > docs/STRUCTURE.md
        echo "" >> docs/STRUCTURE.md
        tree -d docs/ >> docs/STRUCTURE.md || echo "tree not available"
    
    - name: Check for broken links
      run: |
        # æ£€æŸ¥æ–‡æ¡£ä¸­çš„å†…éƒ¨é“¾æ¥ï¼ˆç®€åŒ–ç‰ˆï¼‰
        echo "âš ï¸ Link checking planned for future enhancement"
      continue-on-error: true
    
    - name: Build success
      run: |
        echo "âœ… Documentation build completed successfully!"
    
    - name: Upload docs artifact
      if: github.ref == 'refs/heads/main'
      uses: actions/upload-artifact@v3
      with:
        name: documentation
        path: docs/

  # éƒ¨ç½²åˆ°GitHub Pagesï¼ˆå¯é€‰ï¼‰
  deploy-docs:
    name: Deploy to GitHub Pages
    runs-on: ubuntu-latest
    needs: build-docs
    if: github.ref == 'refs/heads/main'
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    
    - name: Deploy placeholder
      run: |
        echo "ğŸ“š Documentation deployment planned for future"
        echo "Options: GitHub Pages, Read the Docs, etc."

