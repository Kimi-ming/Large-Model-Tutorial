# åŒ»ç–—å½±åƒåº”ç”¨

## 1. åº”ç”¨æ¦‚è¿°

### 1.1 åº”ç”¨èƒŒæ™¯

åŒ»ç–—å½±åƒåˆ†ææ˜¯äººå·¥æ™ºèƒ½åœ¨åŒ»ç–—é¢†åŸŸæœ€å…·æ½œåŠ›çš„åº”ç”¨æ–¹å‘ä¹‹ä¸€ã€‚é€šè¿‡æ·±åº¦å­¦ä¹ æŠ€æœ¯ï¼Œå¯ä»¥è¾…åŠ©åŒ»ç”Ÿè¿›è¡Œç–¾ç—…è¯Šæ–­ã€ç—…ç¶å®šä½å’Œæ²»ç–—æ–¹æ¡ˆåˆ¶å®šï¼Œæ˜¾è‘—æå‡è¯Šæ–­æ•ˆç‡å’Œå‡†ç¡®æ€§ã€‚

**è¡Œä¸šç—›ç‚¹**ï¼š
- **è¯Šæ–­è´Ÿè·é‡**ï¼šå½±åƒç§‘åŒ»ç”Ÿæ¯æ—¥éœ€é˜…è¯»å¤§é‡CTã€MRIæ‰«æå›¾åƒ
- **ç»éªŒä¾èµ–å¼º**ï¼šè¯Šæ–­è´¨é‡é«˜åº¦ä¾èµ–åŒ»ç”Ÿçš„ä¸´åºŠç»éªŒ
- **æ¼è¯Šé£é™©**ï¼šç–²åŠ³ã€ç»éªŒä¸è¶³å¯èƒ½å¯¼è‡´ç—…ç¶é—æ¼
- **æ ‡æ³¨æˆæœ¬é«˜**ï¼šåŒ»å­¦å›¾åƒæ ‡æ³¨éœ€è¦ä¸“ä¸šåŒ»ç”Ÿï¼Œè€—æ—¶ä¸”æ˜‚è´µ
- **æŠ¥å‘Šæ’°å†™æ…¢**ï¼šè¯¦ç»†çš„å½±åƒæŠ¥å‘Šéœ€è¦å¤§é‡æ—¶é—´

**AIè§£å†³æ–¹æ¡ˆä»·å€¼**ï¼š
- âœ… **è¾…åŠ©ç­›æŸ¥**ï¼šè‡ªåŠ¨æ ‡è®°å¯ç–‘åŒºåŸŸï¼Œå‡å°‘æ¼è¯Š
- âœ… **ç²¾å‡†åˆ†å‰²**ï¼šè‡ªåŠ¨å‹¾ç”»ç—…ç¶è¾¹ç•Œï¼Œè¾…åŠ©æ²»ç–—è§„åˆ’
- âœ… **æ™ºèƒ½æ ‡æ³¨**ï¼šåŠè‡ªåŠ¨åŒ–æ ‡æ³¨å·¥å…·ï¼Œé™ä½æ ‡æ³¨æˆæœ¬
- âœ… **æŠ¥å‘Šç”Ÿæˆ**ï¼šè‡ªåŠ¨ç”Ÿæˆåˆæ­¥è¯Šæ–­æè¿°ï¼Œæé«˜æ•ˆç‡
- âœ… **ç»éªŒå¤åˆ¶**ï¼šå°†ä¸“å®¶ç»éªŒå›ºåŒ–ä¸ºæ¨¡å‹ï¼Œè¾…åŠ©åŸºå±‚åŒ»ç–—

### 1.2 åº”ç”¨åœºæ™¯

#### åœºæ™¯1ï¼šè‚ºéƒ¨CTç­›æŸ¥
- **è¾“å…¥**ï¼šèƒ¸éƒ¨CTæ‰«æå›¾åƒ
- **è¾“å‡º**ï¼šè‚ºç»“èŠ‚æ£€æµ‹ã€ç—…ç¶åˆ†å‰²ã€è‰¯æ¶æ€§è¯„ä¼°
- **åº”ç”¨**ï¼šæ—©æœŸè‚ºç™Œç­›æŸ¥ã€ä½“æ£€æŠ¥å‘Šç”Ÿæˆ

#### åœºæ™¯2ï¼šè„‘éƒ¨MRIåˆ†æ
- **è¾“å…¥**ï¼šè„‘éƒ¨MRIå½±åƒï¼ˆT1/T2/FLAIRåºåˆ—ï¼‰
- **è¾“å‡º**ï¼šè‚¿ç˜¤åˆ†å‰²ã€è„‘åŒºæ ‡æ³¨ã€ç—…å˜æè¿°
- **åº”ç”¨**ï¼šè„‘è‚¿ç˜¤è¯Šæ–­ã€æ‰‹æœ¯è§„åˆ’

#### åœºæ™¯3ï¼šç—…ç†åˆ‡ç‰‡åˆ†æ
- **è¾“å…¥**ï¼šæ˜¾å¾®é•œç—…ç†å›¾åƒ
- **è¾“å‡º**ï¼šç™Œç»†èƒè¯†åˆ«ã€ç»„ç»‡åˆ†ç±»ã€é‡åŒ–åˆ†æ
- **åº”ç”¨**ï¼šç—…ç†è¯Šæ–­è¾…åŠ©ã€ç™Œç—‡åˆ†çº§

#### åœºæ™¯4ï¼šåŒ»å­¦å›¾åƒé—®ç­”
- **è¾“å…¥**ï¼šåŒ»å­¦å½±åƒ + åŒ»ç”Ÿé—®é¢˜
- **è¾“å‡º**ï¼šæ™ºèƒ½å›ç­”ï¼ˆç—…ç¶ä½ç½®ã€ç‰¹å¾æè¿°ã€é‰´åˆ«è¯Šæ–­å»ºè®®ï¼‰
- **åº”ç”¨**ï¼šè¾…åŠ©è¯Šæ–­ã€åŒ»å­¦æ•™è‚²

### 1.3 æŠ€æœ¯æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      åŒ»ç–—å½±åƒAIåº”ç”¨                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚                         â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  ç—…ç¶æ£€æµ‹ä¸åˆ†å‰²  â”‚       â”‚  å½±åƒç†è§£é—®ç­”  â”‚
        â”‚   (SAM-Med)     â”‚       â”‚   (MedBLIP)    â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚                        â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ â€¢ äº¤äº’å¼åˆ†å‰²     â”‚      â”‚ â€¢ å½±åƒæè¿°      â”‚
        â”‚ â€¢ è‡ªåŠ¨åŒ–æ ‡æ³¨     â”‚      â”‚ â€¢ è¯Šæ–­é—®ç­”      â”‚
        â”‚ â€¢ 3Dé‡å»ºè¾…åŠ©     â”‚      â”‚ â€¢ æŠ¥å‘Šç”Ÿæˆ      â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚                        â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   å¤šæ¨¡æ€èåˆå±‚     â”‚
                    â”‚ â€¢ å½±åƒ + æ–‡æœ¬      â”‚
                    â”‚ â€¢ è¯Šæ–­æ¨ç†         â”‚
                    â”‚ â€¢ ç½®ä¿¡åº¦è¯„ä¼°       â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   åº”ç”¨æœåŠ¡å±‚       â”‚
                    â”‚ â€¢ PACSé›†æˆ         â”‚
                    â”‚ â€¢ HISå¯¹æ¥          â”‚
                    â”‚ â€¢ å®¡æ ¸å·¥ä½œæµ       â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ ¸å¿ƒç»„ä»¶**ï¼š

1. **ç—…ç¶åˆ†å‰²æ¨¡å—ï¼ˆåŸºäºSAMï¼‰**
   - äº¤äº’å¼åˆ†å‰²ï¼šåŒ»ç”Ÿç‚¹å‡»/æ¡†é€‰ â†’ ç²¾ç¡®åˆ†å‰²
   - æ‰¹é‡è‡ªåŠ¨åˆ†å‰²ï¼šåŸºäºå…ˆéªŒæç¤ºçš„è‡ªåŠ¨åŒ–å¤„ç†
   - 3Dåˆ†å‰²ï¼šå¤šåˆ‡ç‰‡è”åˆåˆ†å‰²ï¼Œç”Ÿæˆ3Dæ¨¡å‹

2. **å½±åƒç†è§£æ¨¡å—ï¼ˆåŸºäºBLIP-2ï¼‰**
   - å½±åƒæè¿°ï¼šç”Ÿæˆç»“æ„åŒ–å½±åƒæŠ¥å‘Š
   - è¯Šæ–­é—®ç­”ï¼šå›ç­”åŒ»ç”Ÿå…³äºå½±åƒçš„å…·ä½“é—®é¢˜
   - å¤šè½®å¯¹è¯ï¼šä¸Šä¸‹æ–‡ç†è§£ï¼Œæ”¯æŒå¤æ‚æ¨ç†

3. **å¤šæ¨¡æ€èåˆ**
   - å½±åƒç‰¹å¾ + ä¸´åºŠä¿¡æ¯ï¼ˆå¹´é¾„ã€ç—‡çŠ¶ã€ç—…å²ï¼‰
   - åˆ†å‰²ç»“æœ + å½±åƒæè¿° â†’ ç»¼åˆè¯Šæ–­å»ºè®®
   - ç½®ä¿¡åº¦è¯„ä¼°ï¼šè¯†åˆ«ä¸ç¡®å®šæƒ…å†µï¼Œå»ºè®®äººå·¥å¤æ ¸

---

## 2. æŠ€æœ¯å®ç°

### 2.1 ç—…ç¶åˆ†å‰²ï¼ˆSAM-Medï¼‰

#### 2.1.1 äº¤äº’å¼åˆ†å‰²

**åº”ç”¨åœºæ™¯**ï¼šåŒ»ç”Ÿåœ¨é˜…ç‰‡è¿‡ç¨‹ä¸­ï¼Œéœ€è¦ç²¾ç¡®å‹¾ç”»ç—…ç¶è¾¹ç•Œï¼ˆå¦‚è‚¿ç˜¤ã€ç»“èŠ‚ï¼‰

```python
# å‘½ä»¤è¡Œæ–¹å¼ï¼ˆæ¨èï¼‰
python code/05-applications/medical/lesion_segmentor.py \
    --image ct_scan.png \
    --mode interactive \
    --prompt point \
    --coords "[[150,200],[180,220]]" \
    --labels "[1,1]" \
    --output segmentation.png

# Python APIæ–¹å¼
import sys
sys.path.insert(0, 'code/05-applications/medical')
exec(open('code/05-applications/medical/lesion_segmentor.py').read(), globals())

# åˆå§‹åŒ–åˆ†å‰²å™¨
segmentor = LesionSegmentor(
    model_type='vit_h',
    checkpoint='checkpoints/sam_vit_h.pth'
)

# åŠ è½½åŒ»å­¦å½±åƒ
image = segmentor.load_image('ct_scan.png')

# äº¤äº’å¼åˆ†å‰²ï¼ˆç‚¹æç¤ºï¼‰
result = segmentor.segment_interactive(
    image=image,
    prompt_type='point',
    points=[[150, 200], [180, 220]],  # åŒ»ç”Ÿç‚¹å‡»çš„åæ ‡
    labels=[1, 1]  # 1=å‰æ™¯ç‚¹
)

# ä¿å­˜åˆ†å‰²ç»“æœ
segmentor.save_result(result, 'segmentation.png')
print(f"åˆ†å‰²å®Œæˆï¼æ©ç è¦†ç›– {result['area']} åƒç´ ")
```

**è¾“å‡ºç¤ºä¾‹**ï¼š
```python
{
    'mask': np.ndarray,        # åˆ†å‰²æ©ç  (H, W)
    'area': 1234,              # ç—…ç¶é¢ç§¯ï¼ˆåƒç´ ï¼‰
    'bbox': [x, y, w, h],      # è¾¹ç•Œæ¡†
    'confidence': 0.95,        # ç½®ä¿¡åº¦
    'diameter': 35.2           # ç­‰æ•ˆç›´å¾„ï¼ˆmmï¼‰
}
```

#### 2.1.2 è‡ªåŠ¨æ‰¹é‡åˆ†å‰²

**åº”ç”¨åœºæ™¯**ï¼šå¤§è§„æ¨¡ç­›æŸ¥ï¼ˆå¦‚è‚ºç»“èŠ‚ç­›æŸ¥ï¼‰ï¼Œéœ€è¦è‡ªåŠ¨æ£€æµ‹å¹¶åˆ†å‰²æ‰€æœ‰å¯ç–‘ç—…ç¶

```python
# å‘½ä»¤è¡Œæ–¹å¼
python code/05-applications/medical/lesion_segmentor.py \
    --image lung_ct.png \
    --mode auto \
    --lesion-type nodule \
    --min-size 3 \
    --output auto_segmentation.png

# Python APIæ–¹å¼
# ï¼ˆä½¿ç”¨ä¸Šè¿°åŠ è½½æ–¹å¼ï¼‰

# è‡ªåŠ¨åˆ†å‰²ï¼ˆåŸºäºé¢„å®šä¹‰çš„è‚ºç»“èŠ‚æ£€æµ‹æç¤ºï¼‰
results = segmentor.segment_auto(
    image=image,
    lesion_type='nodule',  # ç—…ç¶ç±»å‹ï¼šnodule, tumor, lesion
    min_size=3,            # æœ€å°ç›´å¾„ï¼ˆmmï¼‰
    nms_threshold=0.5      # é‡å æŠ‘åˆ¶é˜ˆå€¼
)

# éå†æ£€æµ‹åˆ°çš„ç—…ç¶
for i, lesion in enumerate(results):
    print(f"ç—…ç¶ {i+1}:")
    print(f"  ä½ç½®: {lesion['bbox']}")
    print(f"  ç›´å¾„: {lesion['diameter']:.1f} mm")
    print(f"  é¢ç§¯: {lesion['area']} åƒç´ ")
    print(f"  ç±»å‹: {lesion['lesion_type']}")
    print(f"  ç½®ä¿¡åº¦: {lesion['confidence']:.2f}")
```

#### 2.1.3 3Dåˆ†å‰²ä¸å¯è§†åŒ–

**åº”ç”¨åœºæ™¯**ï¼šå¤šåˆ‡ç‰‡CT/MRIæ‰«æçš„3Dç—…ç¶é‡å»º

```python
# å‘½ä»¤è¡Œæ–¹å¼
python code/05-applications/medical/lesion_segmentor.py \
    --image-dir ct_series/ \
    --mode 3d \
    --prompt point \
    --coords "[[150,200]]" \
    --slice-index 15 \
    --output 3d_segmentation.nii.gz

# Python APIæ–¹å¼
# åŠ è½½CTåºåˆ—
ct_series = segmentor.load_series('ct_series/')  # DICOMæˆ–PNGåºåˆ—

# 3Dåˆ†å‰²ï¼ˆä»ä¸­é—´åˆ‡ç‰‡çš„ç‚¹æç¤ºå¼€å§‹ï¼Œä¼ æ’­åˆ°ç›¸é‚»åˆ‡ç‰‡ï¼‰
result_3d = segmentor.segment_3d(
    series=ct_series,
    seed_slice=15,             # ç§å­åˆ‡ç‰‡ç´¢å¼•
    seed_point=[150, 200],     # ç§å­ç‚¹åæ ‡
    propagation='bidirectional' # åŒå‘ä¼ æ’­
)

# è®¡ç®—3DæŒ‡æ ‡
print(f"3Dä½“ç§¯: {result_3d['volume_mm3']:.1f} mmÂ³")
print(f"æœ€å¤§ç›´å¾„: {result_3d['max_diameter']:.1f} mm")

# ä¿å­˜ä¸ºNIfTIæ ¼å¼ï¼ˆç”¨äº3D Slicerç­‰å·¥å…·å¯è§†åŒ–ï¼‰
segmentor.save_nifti(result_3d['mask_3d'], '3d_segmentation.nii.gz')
```

### 2.2 å½±åƒç†è§£ä¸é—®ç­”ï¼ˆMedBLIPï¼‰

#### 2.2.1 å½±åƒæè¿°ç”Ÿæˆ

**åº”ç”¨åœºæ™¯**ï¼šè‡ªåŠ¨ç”Ÿæˆåˆæ­¥å½±åƒæŠ¥å‘Šï¼Œå‡å°‘åŒ»ç”Ÿæ’°å†™æ—¶é—´

```python
# å‘½ä»¤è¡Œæ–¹å¼
python code/05-applications/medical/image_analyzer.py \
    --image chest_xray.png \
    --task caption \
    --detail high \
    --output report.txt

# Python APIæ–¹å¼
import sys
sys.path.insert(0, 'code/05-applications/medical')
exec(open('code/05-applications/medical/image_analyzer.py').read(), globals())

# åˆå§‹åŒ–åˆ†æå™¨
analyzer = MedicalImageAnalyzer(
    model_name='Salesforce/blip2-opt-2.7b',
    device='cuda'
)

# ç”Ÿæˆå½±åƒæè¿°
image = analyzer.load_image('chest_xray.png')
caption = analyzer.generate_caption(
    image=image,
    detail_level='high',  # low/medium/high
    template='chest_xray' # ä½¿ç”¨èƒ¸ç‰‡æ¨¡æ¿
)

print("å½±åƒæŠ¥å‘Šï¼š")
print(caption)
```

**è¾“å‡ºç¤ºä¾‹**ï¼ˆèƒ¸ç‰‡ï¼‰ï¼š
```
ã€å½±åƒæè¿°ã€‘
æ£€æŸ¥æ–¹æ³•ï¼šèƒ¸éƒ¨æ­£ä½Xçº¿ç‰‡
å½±åƒè¡¨ç°ï¼š
- åŒè‚ºé‡æ¸…æ™°ï¼Œæœªè§æ˜æ˜¾å®è´¨æ€§ç—…å˜
- å³è‚ºä¸­é‡å¯è§ç›´å¾„çº¦8mmåœ†å½¢é«˜å¯†åº¦å½±ï¼Œè¾¹ç•Œæ¸…æ™°
- è‚ºé—¨å½±ä¸å¤§ï¼Œçºµéš”å±…ä¸­
- å¿ƒå½±å¤§å°å½¢æ€æ­£å¸¸
- åŒä¾§è‚‹è†ˆè§’é”åˆ©

ã€åˆæ­¥å°è±¡ã€‘
å³è‚ºä¸­é‡ç»“èŠ‚å½±ï¼Œå»ºè®®CTè¿›ä¸€æ­¥æ£€æŸ¥
```

#### 2.2.2 è¯Šæ–­é—®ç­”

**åº”ç”¨åœºæ™¯**ï¼šåŒ»ç”Ÿé’ˆå¯¹å½±åƒæå‡ºå…·ä½“é—®é¢˜ï¼Œè·å–AIè¾…åŠ©æ„è§

```python
# å‘½ä»¤è¡Œæ–¹å¼
python code/05-applications/medical/image_analyzer.py \
    --image brain_mri.png \
    --task vqa \
    --question "Is there any mass lesion in the brain?" \
    --output answer.txt

# Python APIæ–¹å¼
# å•è½®é—®ç­”
answer = analyzer.answer_question(
    image=image,
    question="Is there any mass lesion in the brain?"
)
print(f"å›ç­”: {answer}")

# å¤šè½®å¯¹è¯
conversation = analyzer.start_conversation(image=image)

# ç¬¬1è½®
q1 = "æè¿°è¿™å¼ è„‘éƒ¨MRIçš„ä¸»è¦å‘ç°"
a1 = conversation.ask(q1)
print(f"åŒ»ç”Ÿ: {q1}")
print(f"AI: {a1}")

# ç¬¬2è½®ï¼ˆå¸¦ä¸Šä¸‹æ–‡ï¼‰
q2 = "ç—…ç¶çš„ä½ç½®å’Œå¤§å°ï¼Ÿ"
a2 = conversation.ask(q2)
print(f"åŒ»ç”Ÿ: {q2}")
print(f"AI: {a2}")

# ç¬¬3è½®
q3 = "å¯èƒ½çš„é‰´åˆ«è¯Šæ–­æœ‰å“ªäº›ï¼Ÿ"
a3 = conversation.ask(q3)
print(f"åŒ»ç”Ÿ: {q3}")
print(f"AI: {a3}")
```

**å¯¹è¯ç¤ºä¾‹**ï¼š
```
åŒ»ç”Ÿ: æè¿°è¿™å¼ è„‘éƒ¨MRIçš„ä¸»è¦å‘ç°
AI: åœ¨å³ä¾§é¢å¶å¯è§ä¸€ä¸è§„åˆ™å½¢æ€çš„å¼‚å¸¸ä¿¡å·å½±ï¼ŒT2WIå‘ˆé«˜ä¿¡å·ï¼Œè¾¹ç•Œä¸æ¸…ï¼Œ
    å‘¨å›´ä¼´æœ‰æ˜æ˜¾æ°´è‚¿å¸¦ï¼Œä¸­çº¿ç»“æ„è½»åº¦å·¦ç§»ã€‚

åŒ»ç”Ÿ: ç—…ç¶çš„ä½ç½®å’Œå¤§å°ï¼Ÿ
AI: ç—…ç¶ä½äºå³ä¾§é¢å¶çš®è´¨ä¸‹åŒºï¼Œæœ€å¤§å¾„çº¦3.5cmï¼Œç´¯åŠç™½è´¨å’Œéƒ¨åˆ†ç°è´¨ã€‚

åŒ»ç”Ÿ: å¯èƒ½çš„é‰´åˆ«è¯Šæ–­æœ‰å“ªäº›ï¼Ÿ
AI: æ ¹æ®å½±åƒç‰¹å¾ï¼Œé‰´åˆ«è¯Šæ–­åŒ…æ‹¬ï¼š
    1. é«˜çº§åˆ«èƒ¶è´¨ç˜¤ï¼ˆæœ€å¯èƒ½ï¼‰
    2. è½¬ç§»ç˜¤
    3. æ·‹å·´ç˜¤
    å»ºè®®ç»“åˆä¸´åºŠç—…å²ã€å¢å¼ºæ‰«æåŠå¿…è¦æ—¶æ´»æ£€æ˜ç¡®è¯Šæ–­ã€‚
```

#### 2.2.3 ç»“æ„åŒ–æŠ¥å‘Šç”Ÿæˆ

**åº”ç”¨åœºæ™¯**ï¼šç”Ÿæˆç¬¦åˆåŒ»ç–—è§„èŒƒçš„ç»“æ„åŒ–æŠ¥å‘Š

```python
# å‘½ä»¤è¡Œæ–¹å¼
python code/05-applications/medical/image_analyzer.py \
    --image ct_abdomen.png \
    --task structured_report \
    --template abdomen_ct \
    --output structured_report.json

# Python APIæ–¹å¼
report = analyzer.generate_structured_report(
    image=image,
    template='abdomen_ct',
    include_measurements=True
)

print(json.dumps(report, indent=2, ensure_ascii=False))
```

**è¾“å‡ºç¤ºä¾‹**ï¼ˆJSONæ ¼å¼ï¼‰ï¼š
```json
{
  "patient_info": {
    "study_id": "CT20231115001",
    "modality": "CT",
    "body_part": "Abdomen"
  },
  "findings": [
    {
      "organ": "liver",
      "description": "è‚è„å¤§å°å½¢æ€æ­£å¸¸ï¼Œå¯†åº¦å‡åŒ€",
      "abnormality": false
    },
    {
      "organ": "kidney",
      "description": "å³è‚¾ä¸­æè§ä¸€ä½å¯†åº¦å›Šæ€§ç¶ï¼Œç›´å¾„çº¦2.3cm",
      "abnormality": true,
      "location": "right kidney, mid pole",
      "size": "2.3 cm",
      "characteristics": ["cystic", "well-defined", "homogeneous"]
    },
    {
      "organ": "pancreas",
      "description": "èƒ°è…ºæœªè§æ˜æ˜¾å¼‚å¸¸",
      "abnormality": false
    }
  ],
  "impression": [
    "å³è‚¾å›Šè‚¿ï¼ˆBosniak Içº§ï¼‰",
    "è‚è„ã€èƒ°è…ºã€è„¾è„æœªè§æ˜æ˜¾å¼‚å¸¸"
  ],
  "recommendation": "å»ºè®®6-12ä¸ªæœˆå¤æŸ¥è¶…å£°æˆ–CTï¼Œè§‚å¯Ÿå›Šè‚¿å˜åŒ–"
}
```

### 2.3 å¤šæ¨¡æ€èåˆè¯Šæ–­

#### 2.3.1 å½±åƒ + ä¸´åºŠä¿¡æ¯èåˆ

**åº”ç”¨åœºæ™¯**ï¼šç»“åˆå½±åƒå’Œæ‚£è€…ä¸´åºŠä¿¡æ¯ï¼Œæä¾›æ›´ç²¾å‡†çš„è¯Šæ–­å»ºè®®

```python
# å‘½ä»¤è¡Œæ–¹å¼
python code/05-applications/medical/image_analyzer.py \
    --image lung_ct.png \
    --task multimodal \
    --clinical-info clinical_data.json \
    --output diagnosis.json

# Python APIæ–¹å¼
# å‡†å¤‡ä¸´åºŠä¿¡æ¯
clinical_info = {
    'age': 65,
    'gender': 'male',
    'smoking_history': 'heavy smoker (40 pack-years)',
    'symptoms': ['persistent cough', 'weight loss'],
    'lab_results': {
        'CEA': 8.5,  # ç™ŒèƒšæŠ—åŸï¼ˆæ­£å¸¸<5ï¼‰
        'NSE': 25.3  # ç¥ç»å…ƒç‰¹å¼‚æ€§çƒ¯é†‡åŒ–é…¶
    }
}

# å¤šæ¨¡æ€è¯Šæ–­
diagnosis = analyzer.multimodal_diagnosis(
    image=image,
    clinical_info=clinical_info,
    explain=True  # ç”Ÿæˆè§£é‡Š
)

print(json.dumps(diagnosis, indent=2, ensure_ascii=False))
```

**è¾“å‡ºç¤ºä¾‹**ï¼š
```json
{
  "primary_diagnosis": "è‚ºç™Œé«˜åº¦å¯ç–‘",
  "confidence": 0.87,
  "evidence": {
    "imaging": [
      "å³è‚ºä¸Šå¶è§ä¸è§„åˆ™è‚¿å—ï¼Œç›´å¾„çº¦4.2cm",
      "è¾¹ç¼˜æœ‰æ¯›åˆºå¾ï¼Œå†…éƒ¨æœ‰ç©ºæ´",
      "çºµéš”æ·‹å·´ç»“è‚¿å¤§"
    ],
    "clinical": [
      "é«˜å±å› ç´ ï¼š65å²ç”·æ€§ï¼Œé‡åº¦å¸çƒŸå²",
      "å…¸å‹ç—‡çŠ¶ï¼šæŒç»­å’³å—½ã€ä½“é‡ä¸‹é™",
      "è‚¿ç˜¤æ ‡å¿—ç‰©å‡é«˜ï¼šCEA 8.5 ng/mL"
    ]
  },
  "differential_diagnosis": [
    {"disease": "è‚ºè…ºç™Œ", "probability": 0.55},
    {"disease": "é³çŠ¶ç»†èƒç™Œ", "probability": 0.25},
    {"disease": "å°ç»†èƒè‚ºç™Œ", "probability": 0.07}
  ],
  "recommendation": [
    "å¼ºçƒˆå»ºè®®PET-CTæ£€æŸ¥è¯„ä¼°è½¬ç§»æƒ…å†µ",
    "å»ºè®®ç©¿åˆºæ´»æ£€æ˜ç¡®ç—…ç†ç±»å‹",
    "å»ºè®®å‘¼å¸å†…ç§‘æˆ–èƒ¸å¤–ç§‘ä¼šè¯Š"
  ],
  "urgency": "high",
  "explanation": "åŸºäºå½±åƒå­¦æ¯›åˆºå¾ã€ç©ºæ´å½¢æˆç­‰æ¶æ€§ç‰¹å¾ï¼Œç»“åˆæ‚£è€…é«˜å±å› ç´ åŠè‚¿ç˜¤æ ‡å¿—ç‰©å‡é«˜ï¼Œè‚ºç™Œå¯èƒ½æ€§æå¤§ã€‚å»ºè®®å°½å¿«å®Œå–„æ£€æŸ¥æ˜ç¡®è¯Šæ–­å’Œåˆ†æœŸã€‚"
}
```

#### 2.3.2 åˆ†å‰² + æè¿°è”åˆåˆ†æ

**åº”ç”¨åœºæ™¯**ï¼šå…ˆåˆ†å‰²ç—…ç¶ï¼Œå†åŸºäºåˆ†å‰²ç»“æœç”Ÿæˆç²¾ç¡®çš„å®šé‡æè¿°

```python
# è”åˆåˆ†ææµç¨‹
# 1. åˆ†å‰²ç—…ç¶
segmentation = segmentor.segment_interactive(
    image=image,
    prompt_type='point',
    points=[[200, 150]],
    labels=[1]
)

# 2. æå–ç—…ç¶ROI
lesion_roi = segmentor.extract_roi(image, segmentation['mask'])

# 3. åˆ†æç—…ç¶ç‰¹å¾
analysis = analyzer.analyze_lesion(
    roi=lesion_roi,
    mask=segmentation['mask'],
    modality='CT',
    context='lung'
)

print(f"ç—…ç¶å®šé‡åˆ†æ:")
print(f"  å¤§å°: {analysis['size']['diameter']:.1f} mm")
print(f"  å½¢æ€: {analysis['shape']['regularity']}")  # regular/irregular
print(f"  å¯†åº¦: {analysis['intensity']['mean_hu']:.0f} HU")
print(f"  è´¨åœ°: {analysis['texture']['type']}")     # solid/ground-glass/mixed
print(f"  æ¶æ€§é£é™©: {analysis['malignancy_risk']}")  # low/medium/high
```

---

## 3. éƒ¨ç½²æŒ‡å—

### 3.1 ç¯å¢ƒé…ç½®

#### 3.1.1 åŸºç¡€ç¯å¢ƒ

```bash
# 1. å…‹éš†ä»“åº“
git clone https://github.com/your-org/Large-Model-Tutorial.git
cd Large-Model-Tutorial

# 2. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
conda create -n medical-ai python=3.9
conda activate medical-ai

# 3. å®‰è£…ä¾èµ–
pip install torch torchvision --index-url https://download.pytorch.org/whl/cu118
pip install transformers accelerate pillow numpy opencv-python
pip install segment-anything

# åŒ»å­¦å½±åƒä¸“ç”¨åº“
pip install SimpleITK pydicom nibabel
```

#### 3.1.2 æ¨¡å‹ä¸‹è½½

```bash
# SAMæ¨¡å‹
mkdir -p checkpoints
cd checkpoints

# ä¸‹è½½SAM-Medï¼ˆåŒ»ç–—å½±åƒå¾®è°ƒç‰ˆæœ¬ï¼‰
wget https://dl.fbaipublicfiles.com/segment_anything/sam_vit_h_4b8939.pth
# æˆ–ä½¿ç”¨åŸå§‹SAM
wget https://dl.fbaipublicfiles.com/segment_anything/sam_vit_b_01ec64.pth

# BLIP-2ä¼šè‡ªåŠ¨ä»Hugging Faceä¸‹è½½
# æˆ–æ‰‹åŠ¨æŒ‡å®šæœ¬åœ°è·¯å¾„
```

### 3.2 å¿«é€Ÿå¼€å§‹

#### 3.2.1 ç—…ç¶åˆ†å‰²ç¤ºä¾‹

```bash
# è¿›å…¥åŒ»ç–—åº”ç”¨ç›®å½•
cd code/05-applications/medical

# äº¤äº’å¼åˆ†å‰²
python lesion_segmentor.py \
    --image examples/ct_lung.png \
    --mode interactive \
    --prompt point \
    --coords "[[256,128]]" \
    --labels "[1]" \
    --output results/segmentation.png \
    --visualize

# è‡ªåŠ¨æ‰¹é‡åˆ†å‰²
python lesion_segmentor.py \
    --image examples/ct_lung.png \
    --mode auto \
    --lesion-type nodule \
    --min-size 3 \
    --output results/auto_seg.png \
    --visualize
```

#### 3.2.2 å½±åƒåˆ†æç¤ºä¾‹

```bash
# ç”Ÿæˆå½±åƒæè¿°
python image_analyzer.py \
    --image examples/chest_xray.png \
    --task caption \
    --detail high \
    --output results/report.txt

# è¯Šæ–­é—®ç­”
python image_analyzer.py \
    --image examples/brain_mri.png \
    --task vqa \
    --question "æ˜¯å¦å­˜åœ¨è‚¿ç˜¤ç—…ç¶ï¼Ÿ" \
    --output results/answer.txt

# ç»“æ„åŒ–æŠ¥å‘Š
python image_analyzer.py \
    --image examples/ct_abdomen.png \
    --task structured_report \
    --template abdomen_ct \
    --output results/structured_report.json
```

### 3.3 PACSç³»ç»Ÿé›†æˆ

#### 3.3.1 DICOMæ”¯æŒ

```python
# DICOMæ–‡ä»¶è¯»å–ä¸å¤„ç†
import pydicom
from lesion_segmentor import LesionSegmentor

# è¯»å–DICOMæ–‡ä»¶
ds = pydicom.dcmread('patient_001.dcm')
image_array = ds.pixel_array

# çª—å®½çª—ä½è°ƒæ•´ï¼ˆè‚ºçª—ï¼‰
window_center = -600
window_width = 1500
image_windowed = apply_window(image_array, window_center, window_width)

# åˆ†å‰²
segmentor = LesionSegmentor()
result = segmentor.segment_interactive(
    image=image_windowed,
    prompt_type='box',
    box=[x, y, x+w, y+h]
)

# ä¿å­˜åˆ†å‰²ç»“æœåˆ°DICOM RT Structure Set
save_dicom_rtstruct(result['mask'], ds, 'output.dcm')
```

#### 3.3.2 HL7 FHIRæ¥å£ï¼ˆè§„åˆ’ä¸­ - P2é˜¶æ®µï¼‰

```python
# æ³¨æ„ï¼šä»¥ä¸‹ä¸ºè§„åˆ’åŠŸèƒ½ï¼ŒP2é˜¶æ®µå®ç°
# å½“å‰é˜¶æ®µè¯·ä½¿ç”¨å‘½ä»¤è¡Œå·¥å…·æˆ–Python API

# é€šè¿‡FHIRæ¥å£è·å–å½±åƒå’Œä¸´åºŠä¿¡æ¯
# fhir_client = FHIRClient(base_url='http://hospital.org/fhir')
# imaging_study = fhir_client.get_imaging_study(study_id='123')
# patient_info = fhir_client.get_patient(patient_id='456')

# # AIåˆ†æ
# diagnosis = analyzer.multimodal_diagnosis(
#     image=imaging_study.image,
#     clinical_info=patient_info.to_dict()
# )

# # å›å†™ç»“æœåˆ°FHIR
# observation = create_diagnostic_report(diagnosis)
# fhir_client.create_observation(observation)
```

### 3.4 æ€§èƒ½ä¼˜åŒ–

#### 3.4.1 GPUåŠ é€Ÿ

```python
# è‡ªåŠ¨æ£€æµ‹å¹¶ä½¿ç”¨GPU
import torch

device = 'cuda' if torch.cuda.is_available() else 'cpu'
print(f"Using device: {device}")

# åˆå§‹åŒ–æ¨¡å‹
segmentor = LesionSegmentor(device=device)
analyzer = MedicalImageAnalyzer(device=device)

# æ‰¹é‡å¤„ç†ä¼˜åŒ–
images = [load_image(f) for f in image_files]
results = segmentor.segment_batch(images, batch_size=8)
```

#### 3.4.2 æ··åˆç²¾åº¦æ¨ç†

```python
# ä½¿ç”¨FP16å‡å°‘æ˜¾å­˜å ç”¨ï¼Œæå‡é€Ÿåº¦
segmentor = LesionSegmentor(
    device='cuda',
    precision='fp16'  # æˆ– 'bf16'
)

# é€Ÿåº¦å¯¹æ¯”ï¼ˆRTX 3090ï¼‰
# FP32: 2.3s/image
# FP16: 1.1s/image (2.1xåŠ é€Ÿ)
```

---

## 4. å…¸å‹æ¡ˆä¾‹

### 4.1 è‚ºç»“èŠ‚ç­›æŸ¥ç³»ç»Ÿ

#### 4.1.1 ä¸šåŠ¡åœºæ™¯

æŸä¸‰ç”²åŒ»é™¢æ¯å¹´è¿›è¡Œçº¦50,000ä¾‹èƒ¸éƒ¨CTç­›æŸ¥ï¼Œå½±åƒç§‘åŒ»ç”Ÿäººå‡æ¯æ—¥éœ€é˜…è¯»150ä¾‹ã€‚AIç³»ç»Ÿè¾…åŠ©ç­›æŸ¥å¯ä»¥ï¼š
- è‡ªåŠ¨æ ‡è®°å¯ç–‘ç»“èŠ‚ï¼Œå‡å°‘æ¼è¯Š
- é‡åŒ–ç»“èŠ‚ç‰¹å¾ï¼ˆå¤§å°ã€å¯†åº¦ã€å½¢æ€ï¼‰ï¼Œè¾…åŠ©è‰¯æ¶æ€§åˆ¤æ–­
- è‡ªåŠ¨ç”Ÿæˆåˆæ­¥æŠ¥å‘Šï¼Œå‡å°‘æŠ¥å‘Šæ’°å†™æ—¶é—´

#### 4.1.2 å®æ–½æ–¹æ¡ˆ

```python
# è‚ºç»“èŠ‚ç­›æŸ¥å®Œæ•´æµç¨‹
def lung_nodule_screening(ct_series_path, patient_id):
    """
    è‚ºç»“èŠ‚AIç­›æŸ¥æµç¨‹
    
    Args:
        ct_series_path: CTåºåˆ—DICOMç›®å½•
        patient_id: æ‚£è€…ID
    
    Returns:
        ç­›æŸ¥æŠ¥å‘Šï¼ˆJSONï¼‰
    """
    # 1. åŠ è½½CTåºåˆ—
    ct_series = load_dicom_series(ct_series_path)
    
    # 2. è‡ªåŠ¨æ£€æµ‹ç»“èŠ‚
    segmentor = LesionSegmentor(model_type='vit_h')
    nodules = segmentor.detect_nodules(
        ct_series,
        min_diameter=3,      # æœ€å°3mm
        max_diameter=30,     # æœ€å¤§30mm
        lung_mask=True       # ä»…åœ¨è‚ºé‡å†…æ£€æµ‹
    )
    
    print(f"æ£€æµ‹åˆ° {len(nodules)} ä¸ªè‚ºç»“èŠ‚")
    
    # 3. ç‰¹å¾æå–ä¸åˆ†ç±»
    analyzer = MedicalImageAnalyzer()
    nodule_reports = []
    
    for i, nodule in enumerate(nodules):
        # æå–ç»“èŠ‚ROI
        roi = extract_roi(ct_series, nodule['bbox'], nodule['slice'])
        
        # AIåˆ†æ
        features = analyzer.analyze_nodule(
            roi=roi,
            mask=nodule['mask'],
            clinical_info=None  # å¯é€‰ï¼šæ‚£è€…å¹´é¾„ã€å¸çƒŸå²ç­‰
        )
        
        # ç”Ÿæˆç»“èŠ‚æŠ¥å‘Š
        nodule_report = {
            'nodule_id': f"{patient_id}_nodule_{i+1}",
            'location': {
                'lobe': features['location']['lobe'],  # è‚ºå¶
                'segment': features['location']['segment'],
                'coordinates': nodule['centroid']
            },
            'measurements': {
                'diameter': features['diameter'],  # mm
                'volume': features['volume'],      # mmÂ³
                'density': features['density_type']  # solid/ground-glass/part-solid
            },
            'characteristics': {
                'shape': features['shape'],        # round/oval/irregular
                'margin': features['margin'],      # smooth/lobulated/spiculated
                'calcification': features['calcification']
            },
            'malignancy_score': features['malignancy_probability'],
            'lung_rads': features['lung_rads_category'],  # Lung-RADSåˆ†ç±»
            'recommendation': features['recommendation']
        }
        
        nodule_reports.append(nodule_report)
    
    # 4. ç”Ÿæˆæ€»ç»“æŠ¥å‘Š
    summary = generate_screening_summary(nodule_reports)
    
    return {
        'patient_id': patient_id,
        'study_date': datetime.now().isoformat(),
        'nodule_count': len(nodules),
        'nodules': nodule_reports,
        'summary': summary,
        'overall_recommendation': get_overall_recommendation(nodule_reports)
    }

# ä½¿ç”¨ç¤ºä¾‹
report = lung_nodule_screening(
    ct_series_path='patient_001_ct/',
    patient_id='P001'
)

# ä¿å­˜æŠ¥å‘Š
with open('screening_report.json', 'w', encoding='utf-8') as f:
    json.dump(report, f, indent=2, ensure_ascii=False)
```

**è¾“å‡ºç¤ºä¾‹**ï¼š
```json
{
  "patient_id": "P001",
  "study_date": "2023-11-15T14:30:00",
  "nodule_count": 2,
  "nodules": [
    {
      "nodule_id": "P001_nodule_1",
      "location": {
        "lobe": "å³ä¸Šå¶",
        "segment": "S1",
        "coordinates": [312, 245, 45]
      },
      "measurements": {
        "diameter": 6.2,
        "volume": 125.6,
        "density": "part-solid"
      },
      "characteristics": {
        "shape": "round",
        "margin": "lobulated",
        "calcification": false
      },
      "malignancy_score": 0.65,
      "lung_rads": "4A",
      "recommendation": "3ä¸ªæœˆçŸ­æœŸéšè®¿CT"
    },
    {
      "nodule_id": "P001_nodule_2",
      "location": {
        "lobe": "å·¦ä¸‹å¶",
        "segment": "S6",
        "coordinates": [178, 398, 52]
      },
      "measurements": {
        "diameter": 3.8,
        "volume": 28.7,
        "density": "solid"
      },
      "characteristics": {
        "shape": "round",
        "margin": "smooth",
        "calcification": false
      },
      "malignancy_score": 0.15,
      "lung_rads": "2",
      "recommendation": "12ä¸ªæœˆå¹´åº¦éšè®¿"
    }
  ],
  "summary": "æ£€æµ‹åˆ°2ä¸ªè‚ºç»“èŠ‚ã€‚å…¶ä¸­1ä¸ªä¸ºLung-RADS 4Aç±»åˆ«ï¼ˆéƒ¨åˆ†å®æ€§ç»“èŠ‚ï¼Œç›´å¾„6.2mmï¼‰ï¼Œå»ºè®®çŸ­æœŸéšè®¿ï¼›1ä¸ªä¸ºLung-RADS 2ç±»åˆ«ï¼ˆè‰¯æ€§è¡¨ç°ï¼‰ï¼Œå»ºè®®å¹´åº¦éšè®¿ã€‚",
  "overall_recommendation": "3ä¸ªæœˆçŸ­æœŸéšè®¿CTï¼ˆé’ˆå¯¹å³ä¸Šå¶ç»“èŠ‚ï¼‰"
}
```

#### 4.1.3 ä¸šåŠ¡æ•ˆæœ

| æŒ‡æ ‡ | AIè¾…åŠ©å‰ | AIè¾…åŠ©å | æå‡ |
|------|---------|---------|------|
| å¹³å‡é˜…ç‰‡æ—¶é—´ | 8åˆ†é’Ÿ/ä¾‹ | 3åˆ†é’Ÿ/ä¾‹ | **62.5%â†“** |
| ç»“èŠ‚æ£€å‡ºç‡ | 89% | 96% | **7ppâ†‘** |
| æŠ¥å‘Šæ’°å†™æ—¶é—´ | 5åˆ†é’Ÿ/ä¾‹ | 1åˆ†é’Ÿ/ä¾‹ | **80%â†“** |
| åŒ»ç”Ÿæ—¥å‡é˜…ç‰‡é‡ | 150ä¾‹ | 250ä¾‹ | **67%â†‘** |

**ç»æµæ•ˆç›Š**ï¼š
- èŠ‚çœäººåŠ›æˆæœ¬ï¼šå‡å°‘2åå½±åƒåŒ»ç”Ÿ â†’ èŠ‚çº¦Â¥60ä¸‡/å¹´
- æå‡ç­›æŸ¥èƒ½åŠ›ï¼šå¹´ç­›æŸ¥é‡ä»50,000å¢è‡³70,000 â†’ å¢æ”¶Â¥200ä¸‡/å¹´
- å‡å°‘æ¼è¯Šé£é™©ï¼šé¿å…åŒ»ç–—çº çº·å’Œèµ”å¿

### 4.2 è„‘è‚¿ç˜¤æ‰‹æœ¯è§„åˆ’

#### 4.2.1 ä¸šåŠ¡åœºæ™¯

ç¥ç»å¤–ç§‘åŒ»ç”Ÿåœ¨åˆ¶å®šè„‘è‚¿ç˜¤æ‰‹æœ¯æ–¹æ¡ˆæ—¶ï¼Œéœ€è¦ï¼š
- ç²¾ç¡®å‹¾ç”»è‚¿ç˜¤è¾¹ç•Œ
- è¯„ä¼°è‚¿ç˜¤ä¸é‡è¦åŠŸèƒ½åŒºï¼ˆå¦‚è¿åŠ¨åŒºã€è¯­è¨€åŒºï¼‰çš„å…³ç³»
- é¢„æµ‹æ‰‹æœ¯é£é™©å’Œé¢„å

#### 4.2.2 å®æ–½æ–¹æ¡ˆ

```python
# å‘½ä»¤è¡Œæ–¹å¼
python code/05-applications/medical/lesion_segmentor.py \
    --image-dir brain_mri_series/ \
    --mode 3d \
    --prompt point \
    --coords "[[120,150]]" \
    --slice-index 25 \
    --output tumor_3d.nii.gz

# Python APIæ–¹å¼
# 1. 3Dè‚¿ç˜¤åˆ†å‰²
segmentor = LesionSegmentor(model_type='vit_h')
mri_series = segmentor.load_series('brain_mri_series/')

tumor_3d = segmentor.segment_3d(
    series=mri_series,
    seed_slice=25,
    seed_point=[120, 150],
    propagation='bidirectional'
)

# 2. ç”Ÿæˆ3Dæ¨¡å‹
mesh = segmentor.generate_mesh(tumor_3d['mask_3d'])
segmentor.save_mesh(mesh, 'tumor.stl')  # å¯å¯¼å…¥3D Slicer

# 3. æ‰‹æœ¯è§„åˆ’åˆ†æ
analyzer = MedicalImageAnalyzer()
surgical_plan = analyzer.analyze_surgical_risk(
    tumor_mask=tumor_3d['mask_3d'],
    mri_series=mri_series,
    functional_areas=['motor_cortex', 'language_area']
)

print(f"è‚¿ç˜¤ä½“ç§¯: {surgical_plan['tumor_volume']:.1f} cmÂ³")
print(f"æœ€å¤§ç›´å¾„: {surgical_plan['max_diameter']:.1f} mm")
print(f"åŠŸèƒ½åŒºé£é™©è¯„ä¼°:")
for area, risk in surgical_plan['functional_risks'].items():
    print(f"  {area}: {risk['level']} (è·ç¦» {risk['distance']:.1f}mm)")
```

### 4.3 ç—…ç†åˆ‡ç‰‡åˆ†æ

#### 4.3.1 ä¸šåŠ¡åœºæ™¯

ç—…ç†ç§‘åŒ»ç”Ÿéœ€è¦åœ¨æ˜¾å¾®é•œä¸‹åˆ†æç»„ç»‡åˆ‡ç‰‡ï¼Œè¯†åˆ«ç™Œç»†èƒã€è¯„ä¼°è‚¿ç˜¤åˆ†çº§ã€‚AIå¯ä»¥ï¼š
- è‡ªåŠ¨è¯†åˆ«å’Œæ ‡è®°ç™Œç»†èƒåŒºåŸŸ
- é‡åŒ–è‚¿ç˜¤æµ¸æ¶¦ç¨‹åº¦
- è¾…åŠ©åˆ†çº§ï¼ˆå¦‚Gleasonè¯„åˆ†ï¼‰

#### 4.3.2 å®æ–½æ–¹æ¡ˆ

```python
# å‘½ä»¤è¡Œæ–¹å¼
python code/05-applications/medical/lesion_segmentor.py \
    --image pathology_slide.png \
    --mode auto \
    --lesion-type cancer_cells \
    --output cancer_regions.png \
    --visualize

# Python APIæ–¹å¼
# åŠ è½½ç—…ç†åˆ‡ç‰‡ï¼ˆé«˜åˆ†è¾¨ç‡ï¼‰
slide = segmentor.load_image('pathology_slide.png')

# è‡ªåŠ¨åˆ†å‰²ç™Œç»†èƒåŒºåŸŸ
cancer_regions = segmentor.segment_auto(
    image=slide,
    lesion_type='cancer_cells',
    min_size=0.1,  # mm
    confidence_threshold=0.7
)

# é‡åŒ–åˆ†æ
analyzer = MedicalImageAnalyzer()
pathology_report = analyzer.analyze_pathology(
    image=slide,
    segmentations=cancer_regions
)

print(f"ç™Œç»†èƒå æ¯”: {pathology_report['cancer_ratio']:.1%}")
print(f"è‚¿ç˜¤åˆ†çº§: {pathology_report['grade']}")
print(f"Ki-67å¢æ®–æŒ‡æ•°: {pathology_report['ki67_index']:.1%}")
```

---

## 5. åŒ»ç–—åˆè§„ä¸ä¼¦ç†

### 5.1 æ³•è§„éµä»

#### 5.1.1 NMPAè®¤è¯ï¼ˆä¸­å›½ï¼‰

AIåŒ»ç–—è½¯ä»¶åœ¨ä¸­å›½éœ€é€šè¿‡å›½å®¶è¯å“ç›‘ç£ç®¡ç†å±€ï¼ˆNMPAï¼‰è®¤è¯ï¼š
- **äºŒç±»åŒ»ç–—å™¨æ¢°**ï¼šè¾…åŠ©è¯Šæ–­è½¯ä»¶ï¼ˆå¦‚è‚ºç»“èŠ‚æ£€æµ‹ï¼‰
- **ä¸‰ç±»åŒ»ç–—å™¨æ¢°**ï¼šè‡ªä¸»è¯Šæ–­è½¯ä»¶ï¼ˆéœ€ä¸´åºŠè¯•éªŒï¼‰

**æœ¬æ•™ç¨‹ä»£ç å®šä½**ï¼š
- âœ… æ•™è‚²å’Œç ”ç©¶ç”¨é€”
- âœ… ä¸´åºŠè¾…åŠ©å·¥å…·åŸå‹
- âš ï¸ **ä¸å¯ç›´æ¥ç”¨äºä¸´åºŠè¯Šæ–­**ï¼ˆéœ€å®Œæˆè®¤è¯æµç¨‹ï¼‰

#### 5.1.2 FDAè®¤è¯ï¼ˆç¾å›½ï¼‰

ç¾å›½FDAå¯¹AIåŒ»ç–—è½¯ä»¶åˆ†ç±»ï¼š
- **SaMD (Software as a Medical Device)**ï¼šéœ€510(k)æˆ–PMAè®¤è¯
- **CDS (Clinical Decision Support)**ï¼šè‹¥ä»…æä¾›å»ºè®®ä¸”æœ€ç»ˆå†³ç­–ç”±åŒ»ç”Ÿåšå‡ºï¼Œå¯è±å…

#### 5.1.3 GDPRä¸æ•°æ®éšç§ï¼ˆæ¬§ç›Ÿï¼‰

- **å»æ ‡è¯†åŒ–**ï¼šæ‰€æœ‰åŒ»å­¦å½±åƒå¿…é¡»ç§»é™¤æ‚£è€…èº«ä»½ä¿¡æ¯
- **æ•°æ®ä½¿ç”¨åŒæ„**ï¼šæ‚£è€…éœ€æ˜ç¡®åŒæ„æ•°æ®ç”¨äºAIè®­ç»ƒ/åˆ†æ
- **å¯è§£é‡Šæ€§**ï¼šAIå†³ç­–è¿‡ç¨‹éœ€å¯è¿½æº¯ã€å¯è§£é‡Š

### 5.2 ä¸´åºŠéªŒè¯

#### 5.2.1 å›é¡¾æ€§ç ”ç©¶

```python
# åœ¨æ ‡æ³¨æ•°æ®é›†ä¸Šè¯„ä¼°AIæ€§èƒ½
from sklearn.metrics import accuracy_score, roc_auc_score

# åŠ è½½éªŒè¯é›†ï¼ˆ100ä¾‹è‚ºç»“èŠ‚ç—…ä¾‹ï¼Œç—…ç†ç¡®è¯Šï¼‰
validation_set = load_validation_data('lung_nodule_validation/')

predictions = []
ground_truth = []

for case in validation_set:
    # AIé¢„æµ‹
    result = analyzer.analyze_nodule(case['image'])
    predictions.append(result['malignancy_score'])
    ground_truth.append(case['pathology_diagnosis'])  # 0=è‰¯æ€§, 1=æ¶æ€§

# è®¡ç®—AUC
auc = roc_auc_score(ground_truth, predictions)
print(f"AUC: {auc:.3f}")

# ä¸æ”¾å°„ç§‘åŒ»ç”Ÿå¯¹æ¯”
radiologist_auc = 0.88
print(f"AI vs åŒ»ç”Ÿ: {auc:.3f} vs {radiologist_auc:.3f}")
```

**æ€§èƒ½æŒ‡æ ‡ç¤ºä¾‹**ï¼š
| ä»»åŠ¡ | AIæ•æ„Ÿæ€§ | AIç‰¹å¼‚æ€§ | åŒ»ç”Ÿæ•æ„Ÿæ€§ | åŒ»ç”Ÿç‰¹å¼‚æ€§ |
|------|---------|---------|-----------|-----------|
| è‚ºç»“èŠ‚æ£€æµ‹ | 94% | 90% | 89% | 92% |
| æ¶æ€§åˆ¤æ–­ | 87% | 85% | 88% | 86% |

#### 5.2.2 å‰ç»æ€§ä¸´åºŠè¯•éªŒ

**æ ‡å‡†æµç¨‹**ï¼š
1. **ä¼¦ç†å®¡æ‰¹**ï¼šåŒ»é™¢ä¼¦ç†å§”å‘˜ä¼šæ‰¹å‡†
2. **æ‚£è€…æ‹›å‹Ÿ**ï¼šç­¾ç½²çŸ¥æƒ…åŒæ„ä¹¦
3. **åŒç›²å¯¹ç…§**ï¼šAIç»„ vs å¸¸è§„ç»„
4. **ç»Ÿè®¡åˆ†æ**ï¼šä¸»è¦ç»ˆç‚¹ï¼ˆå¦‚è¯Šæ–­å‡†ç¡®ç‡ï¼‰ã€æ¬¡è¦ç»ˆç‚¹ï¼ˆå¦‚é˜…ç‰‡æ—¶é—´ï¼‰
5. **å‘è¡¨è®ºæ–‡**ï¼šåŒè¡Œè¯„å®¡çš„åŒ»å­¦æœŸåˆŠ

### 5.3 è´£ä»»ä¸é£é™©æ§åˆ¶

#### 5.3.1 äººæœºååŒåŸåˆ™

- âœ… **AIä½œä¸ºè¾…åŠ©å·¥å…·**ï¼Œæœ€ç»ˆè¯Šæ–­ç”±åŒ»ç”Ÿåšå‡º
- âœ… **åŒ»ç”Ÿå¯éšæ—¶æ¨ç¿»AIå»ºè®®**
- âœ… **é«˜é£é™©ç—…ä¾‹äººå·¥å¤æ ¸**

#### 5.3.2 ç½®ä¿¡åº¦ä¸ä¸ç¡®å®šæ€§

```python
# AIè¾“å‡ºåº”åŒ…å«ç½®ä¿¡åº¦
result = analyzer.analyze_lesion(image)

if result['confidence'] < 0.7:
    print("âš ï¸ ç½®ä¿¡åº¦è¾ƒä½ï¼Œå»ºè®®èµ„æ·±åŒ»ç”Ÿå¤æ ¸")
    result['requires_review'] = True
else:
    result['requires_review'] = False

# ä¸ç¡®å®šæ€§å¯è§†åŒ–
plot_uncertainty_map(result['uncertainty_map'])
```

#### 5.3.3 å®¡è®¡æ—¥å¿—

```python
# è®°å½•æ‰€æœ‰AIå†³ç­–ï¼Œç”¨äºäº‹åå®¡è®¡
log_entry = {
    'timestamp': datetime.now().isoformat(),
    'patient_id': 'P001',
    'study_id': 'CT20231115001',
    'ai_model': 'SAM-Med-v1.0',
    'input_hash': compute_hash(image),
    'prediction': result,
    'reviewed_by': 'Dr. Zhang',
    'final_diagnosis': 'benign nodule'
}

save_audit_log(log_entry, 'audit_logs/2023-11-15.jsonl')
```

---

## 6. æŠ€æœ¯è·¯çº¿å›¾

### 6.1 å½“å‰èƒ½åŠ›ï¼ˆP1é˜¶æ®µï¼‰

âœ… **å·²å®ç°**ï¼š
- SAMäº¤äº’å¼åˆ†å‰²
- BLIP-2å½±åƒæè¿°ä¸é—®ç­”
- åŸºç¡€å‘½ä»¤è¡Œå·¥å…·
- Python API

### 6.2 è§„åˆ’åŠŸèƒ½ï¼ˆP2é˜¶æ®µï¼‰

ğŸ”œ **å¾…å®ç°**ï¼š
- **åŒ»å­¦ä¸“ç”¨æ¨¡å‹å¾®è°ƒ**
  - SAM-Medï¼ˆåœ¨åŒ»å­¦å½±åƒæ•°æ®é›†ä¸Šå¾®è°ƒï¼‰
  - Med-BLIPï¼ˆåŒ»å­¦è§†è§‰è¯­è¨€é¢„è®­ç»ƒï¼‰
  
- **3Då½±åƒæ”¯æŒ**
  - 3Dåˆ†å‰²ä¸å¯è§†åŒ–
  - å¤šæ¨¡æ€èåˆï¼ˆCT + PETï¼‰
  
- **PACSé›†æˆ**
  - DICOM RT Structure Setæ”¯æŒ
  - HL7 FHIRæ¥å£
  - å·¥ä½œåˆ—è¡¨è‡ªåŠ¨æ‹‰å–
  
- **ä¸´åºŠå·¥ä½œæµ**
  - å®¡æ ¸é˜Ÿåˆ—ç®¡ç†
  - æŠ¥å‘Šæ¨¡æ¿å®šåˆ¶
  - å¤šå­¦ç§‘ä¼šè¯Šï¼ˆMDTï¼‰æ”¯æŒ
  
- **æ€§èƒ½ä¼˜åŒ–**
  - æ¨¡å‹é‡åŒ–ä¸å‰ªæ
  - åˆ†å¸ƒå¼æ¨ç†
  - è¾¹ç¼˜è®¾å¤‡éƒ¨ç½²

### 6.3 æœªæ¥æ–¹å‘

ğŸš€ **å‰æ²¿æ¢ç´¢**ï¼š
- **å¤šæ¨¡æ€å¤§æ¨¡å‹**ï¼šGPT-4Vã€Geminiåœ¨åŒ»ç–—å½±åƒçš„åº”ç”¨
- **è”é‚¦å­¦ä¹ **ï¼šè·¨åŒ»é™¢åä½œè®­ç»ƒï¼Œä¿æŠ¤æ•°æ®éšç§
- **æ•°å­—ç—…ç†å…¨åˆ‡ç‰‡åˆ†æ**ï¼šWhole Slide Image (WSI)
- **æ”¾ç–—è®¡åˆ’ä¼˜åŒ–**ï¼šåŸºäºAIçš„æ”¾å°„æ²»ç–—è®¡åˆ’

---

## 7. å‚è€ƒèµ„æº

### 7.1 ç›¸å…³æ–‡ä»¶

**æ–‡æ¡£**ï¼š
- `docs/01-æ¨¡å‹è°ƒç ”ä¸é€‰å‹/05-SAMæ¨¡å‹è¯¦è§£.md` - SAMåŸç†ä¸åº”ç”¨
- `docs/01-æ¨¡å‹è°ƒç ”ä¸é€‰å‹/06-BLIP2æ¨¡å‹è¯¦è§£.md` - BLIP-2åŸç†
- `docs/04-å¤šå¹³å°éƒ¨ç½²/` - éƒ¨ç½²ä¼˜åŒ–æ–¹æ¡ˆ

**ä»£ç **ï¼š
- `code/01-model-evaluation/examples/sam_inference.py` - SAMæ¨ç†ç¤ºä¾‹
- `code/01-model-evaluation/examples/blip2_inference.py` - BLIP-2æ¨ç†ç¤ºä¾‹
- `code/02-fine-tuning/sam/` - SAMå¾®è°ƒä»£ç 

**åŒ»ç–—åº”ç”¨ä»£ç ï¼ˆå½“å‰å¯ç”¨ï¼‰**ï¼š
- `code/05-applications/medical/lesion_segmentor.py` - ç—…ç¶åˆ†å‰²å·¥å…·
- `code/05-applications/medical/image_analyzer.py` - å½±åƒåˆ†æå·¥å…·

**è§„åˆ’ä¸­ï¼ˆP2é˜¶æ®µï¼‰**ï¼š
- `code/05-applications/medical/pacs_integration.py` - PACSé›†æˆ
- `code/05-applications/medical/clinical_workflow.py` - ä¸´åºŠå·¥ä½œæµ
- `config/medical_config.yaml` - åŒ»ç–—åº”ç”¨é…ç½®æ–‡ä»¶

### 7.2 æ•°æ®é›†

**å…¬å¼€åŒ»å­¦å½±åƒæ•°æ®é›†**ï¼š
- **LIDC-IDRI**ï¼šè‚ºç»“èŠ‚CTæ•°æ®ï¼ˆ1018ä¾‹ï¼‰
- **BraTS**ï¼šè„‘è‚¿ç˜¤MRIåˆ†å‰²ï¼ˆæ•°ç™¾ä¾‹ï¼‰
- **TCGA**ï¼šç—…ç†åˆ‡ç‰‡æ•°æ®ï¼ˆå¤šç™Œç§ï¼‰
- **ChestX-ray14**ï¼šèƒ¸ç‰‡æ•°æ®ï¼ˆ112,120å¼ ï¼‰
- **CheXpert**ï¼šèƒ¸ç‰‡æ ‡æ³¨æ•°æ®ï¼ˆ224,316å¼ ï¼‰

### 7.3 å­¦æœ¯è®ºæ–‡

1. **SAMåœ¨åŒ»å­¦å½±åƒçš„åº”ç”¨**ï¼š
   - "Segment Anything in Medical Images" (MedSAM, Nature Communications 2024)
   - "SAM-Med2D: Medical Image Segmentation with SAM" (arXiv 2023)

2. **åŒ»å­¦è§†è§‰è¯­è¨€æ¨¡å‹**ï¼š
   - "LLaVA-Med: Training Large Language-and-Vision Assistant for Biomedicine" (NeurIPS 2023)
   - "Med-Flamingo: Medical Few-shot Learning with Vision-Language Models" (arXiv 2023)

3. **AIè¾…åŠ©è¯Šæ–­**ï¼š
   - "Deep Learning for Lung Cancer Detection" (Nature Medicine 2019)
   - "AI for Diabetic Retinopathy Screening" (JAMA 2016)

### 7.4 åŒ»ç–—AIå¹³å°

- **Grand Challenge**ï¼šåŒ»å­¦å½±åƒç«èµ›å¹³å°
- **MONAI**ï¼šåŒ»å­¦å½±åƒæ·±åº¦å­¦ä¹ æ¡†æ¶
- **3D Slicer**ï¼šåŒ»å­¦å½±åƒå¯è§†åŒ–ä¸åˆ†æ
- **OHIF Viewer**ï¼šWebç«¯DICOMæŸ¥çœ‹å™¨

---

## 8. å…è´£å£°æ˜

âš ï¸ **é‡è¦æç¤º**ï¼š

1. **æ•™è‚²ç›®çš„**ï¼šæœ¬æ•™ç¨‹ä»…ç”¨äºæŠ€æœ¯å­¦ä¹ å’Œç ”ç©¶ï¼Œä¸æ„æˆåŒ»ç–—å»ºè®®ã€‚

2. **ä¸´åºŠä½¿ç”¨é™åˆ¶**ï¼šä»£ç æœªç»ä¸´åºŠéªŒè¯å’Œç›‘ç®¡è®¤è¯ï¼ˆå¦‚NMPAã€FDAï¼‰ï¼Œ**ä¸å¾—ç›´æ¥ç”¨äºä¸´åºŠè¯Šæ–­**ã€‚

3. **è´£ä»»å£°æ˜**ï¼šä½¿ç”¨æœ¬ä»£ç äº§ç”Ÿçš„ä»»ä½•åŒ»ç–—å†³ç­–åæœç”±ä½¿ç”¨è€…è‡ªè¡Œæ‰¿æ‹…ï¼Œä½œè€…ä¸æ‰¿æ‹…æ³•å¾‹è´£ä»»ã€‚

4. **ä¸“ä¸šå’¨è¯¢**ï¼šæ‰€æœ‰åŒ»ç–—å†³ç­–åº”ç”±æœ‰èµ„è´¨çš„åŒ»ç–—ä¸“ä¸šäººå‘˜åšå‡ºã€‚

5. **æ•°æ®éšç§**ï¼šå¤„ç†çœŸå®æ‚£è€…æ•°æ®æ—¶ï¼Œå¿…é¡»éµå®ˆå½“åœ°æ³•å¾‹æ³•è§„ï¼ˆå¦‚HIPAAã€GDPRã€ã€Šä¸ªäººä¿¡æ¯ä¿æŠ¤æ³•ã€‹ï¼‰ã€‚

---

## 9. è·å–å¸®åŠ©

**é—®é¢˜åé¦ˆ**ï¼š
- GitHub Issues: https://github.com/your-org/Large-Model-Tutorial/issues
- Email: support@example.com

**ç¤¾åŒºäº¤æµ**ï¼š
- å¾®ä¿¡ç¾¤ï¼šæ‰«ç åŠ å…¥"åŒ»ç–—AIæŠ€æœ¯äº¤æµç¾¤"
- çŸ¥ä¹ä¸“æ ï¼šåŒ»ç–—AIå®æˆ˜æ•™ç¨‹

**å•†ä¸šåˆä½œ**ï¼š
- åŒ»é™¢PACSé›†æˆ
- å®šåˆ¶åŒ–æ¨¡å‹è®­ç»ƒ
- ä¸´åºŠéªŒè¯å’¨è¯¢

---

*æœ¬æ–‡æ¡£ç‰ˆæœ¬ï¼šv1.0 | æœ€åæ›´æ–°ï¼š2023-11-15*

