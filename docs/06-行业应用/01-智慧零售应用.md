# æ™ºæ…§é›¶å”®åº”ç”¨

æœ¬æ–‡æ¡£ä»‹ç»å¦‚ä½•ä½¿ç”¨å¤šæ¨¡æ€å¤§æ¨¡å‹æ„å»ºæ™ºæ…§é›¶å”®åº”ç”¨ï¼Œæ¶µç›–å•†å“è¯†åˆ«ã€è´§æ¶åˆ†æã€é¡¾å®¢è¡Œä¸ºåˆ†æç­‰åœºæ™¯ã€‚

## ğŸ“‹ ç›®å½•

- [åº”ç”¨åœºæ™¯](#åº”ç”¨åœºæ™¯)
- [æŠ€æœ¯æ¶æ„](#æŠ€æœ¯æ¶æ„)
- [æ ¸å¿ƒåŠŸèƒ½](#æ ¸å¿ƒåŠŸèƒ½)
- [å®ç°æ–¹æ¡ˆ](#å®ç°æ–¹æ¡ˆ)
- [éƒ¨ç½²æŒ‡å—](#éƒ¨ç½²æŒ‡å—)
- [æ€§èƒ½ä¼˜åŒ–](#æ€§èƒ½ä¼˜åŒ–)
- [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)

---

## ğŸ¯ åº”ç”¨åœºæ™¯

### 1. å•†å“è¯†åˆ«ä¸åˆ†ç±»

**ä¸šåŠ¡éœ€æ±‚**ï¼š
- è‡ªåŠ¨è¯†åˆ«å•†å“ç±»åˆ«
- SKUçº§åˆ«çš„ç²¾å‡†è¯†åˆ«
- æ–°å“å¿«é€Ÿä¸Šæ¶
- åº“å­˜å®æ—¶ç›˜ç‚¹

**æŠ€æœ¯æ–¹æ¡ˆ**ï¼š
- ä½¿ç”¨CLIPè¿›è¡Œé›¶æ ·æœ¬å•†å“åˆ†ç±»
- ä½¿ç”¨SAMè¿›è¡Œå•†å“åˆ†å‰²
- ç»“åˆå•†å“æ•°æ®åº“è¿›è¡ŒåŒ¹é…

**åº”ç”¨ä»·å€¼**ï¼š
- â¬‡ï¸ å‡å°‘äººå·¥å½•å…¥æˆæœ¬ 80%
- âš¡ æå‡åº“å­˜ç›˜ç‚¹æ•ˆç‡ 5å€
- âœ… SKUè¯†åˆ«å‡†ç¡®ç‡ > 95%

### 2. è´§æ¶é™ˆåˆ—åˆ†æ

**ä¸šåŠ¡éœ€æ±‚**ï¼š
- è´§æ¶æ»¡é™ˆç‡ç›‘æµ‹
- å•†å“æ‘†æ”¾ä½ç½®åˆ†æ
- ç¼ºè´§å®æ—¶é¢„è­¦
- é™ˆåˆ—åˆè§„æ€§æ£€æŸ¥

**æŠ€æœ¯æ–¹æ¡ˆ**ï¼š
- ä½¿ç”¨SAMåˆ†å‰²è´§æ¶å’Œå•†å“
- ä½¿ç”¨CLIPè¯†åˆ«å•†å“ç±»åˆ«
- ç©ºé—´ä½ç½®å…³ç³»åˆ†æ

**åº”ç”¨ä»·å€¼**ï¼š
- ğŸ“Š è´§æ¶æ»¡é™ˆç‡æå‡ 15%
- âš ï¸ ç¼ºè´§åŠæ—¶ç‡ > 90%
- ğŸ’° é”€å”®é¢æå‡ 10-20%

### 3. é¡¾å®¢è¡Œä¸ºåˆ†æ

**ä¸šåŠ¡éœ€æ±‚**ï¼š
- é¡¾å®¢å…³æ³¨å•†å“åˆ†æ
- åº—å†…çƒ­åŠ›å›¾ç”Ÿæˆ
- è´­ä¹°æ„å‘é¢„æµ‹
- æœåŠ¡è´¨é‡è¯„ä¼°

**æŠ€æœ¯æ–¹æ¡ˆ**ï¼š
- è§†é¢‘æµåˆ†æï¼ˆç›®æ ‡æ£€æµ‹ï¼‰
- æ³¨æ„åŠ›è¿½è¸ª
- è¡Œä¸ºåºåˆ—åˆ†æ

**åº”ç”¨ä»·å€¼**ï¼š
- ğŸ“ˆ è½¬åŒ–ç‡æå‡ 8-12%
- ğŸ¯ ç²¾å‡†è¥é”€ROIæå‡ 30%
- ğŸ‘¥ å®¢æˆ·æ»¡æ„åº¦æå‡ 15%

### 4. æ™ºèƒ½ç»“ç®—

**ä¸šåŠ¡éœ€æ±‚**ï¼š
- æ— äººæ”¶é“¶
- å•†å“è‡ªåŠ¨è¯†åˆ«
- ä»·æ ¼è‡ªåŠ¨è®¡ç®—
- æ”¯ä»˜æµç¨‹ç®€åŒ–

**æŠ€æœ¯æ–¹æ¡ˆ**ï¼š
- è§†è§‰è¯†åˆ« + é‡é‡ä¼ æ„Ÿå™¨
- å¤šè§’åº¦å•†å“æ‹æ‘„
- å®æ—¶è®¡ä»·

**åº”ç”¨ä»·å€¼**ï¼š
- â±ï¸ ç»“ç®—æ—¶é—´ç¼©çŸ­ 70%
- ğŸ’¼ äººå·¥æˆæœ¬é™ä½ 60%
- ğŸ˜Š ç”¨æˆ·ä½“éªŒæå‡æ˜¾è‘—

---

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        æ™ºæ…§é›¶å”®å¹³å°                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚  å‰ç«¯å±•ç¤ºå±‚  â”‚  â”‚  ç®¡ç†æ§åˆ¶å°  â”‚  â”‚   ç§»åŠ¨ç«¯APP  â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚         â”‚                 â”‚                 â”‚                â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                           â”‚                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚              åº”ç”¨æœåŠ¡å±‚ (FastAPI)                  â”‚      â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”‚
â”‚  â”‚  å•†å“è¯†åˆ«  â”‚  è´§æ¶åˆ†æ  â”‚  é¡¾å®¢åˆ†æ  â”‚  æ™ºèƒ½ç»“ç®—  â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                           â”‚                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚              AIæ¨ç†å±‚ (æ¨¡å‹æœåŠ¡)                   â”‚      â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”‚
â”‚  â”‚   CLIPæœåŠ¡  â”‚   SAMæœåŠ¡   â”‚   BLIP-2æœåŠ¡         â”‚      â”‚
â”‚  â”‚  (å•†å“åˆ†ç±»)  â”‚  (åˆ†å‰²å®šä½)  â”‚  (åœºæ™¯ç†è§£)          â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                           â”‚                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚              æ•°æ®å­˜å‚¨å±‚                            â”‚      â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”‚
â”‚  â”‚ å•†å“æ•°æ®åº“ â”‚ å›¾åƒåº“ â”‚ åˆ†æç»“æœ â”‚ ç”¨æˆ·æ•°æ®         â”‚      â”‚
â”‚  â”‚ (MySQL)   â”‚ (OSS)  â”‚ (Redis)  â”‚ (MongoDB)        â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ¨¡å‹é€‰å‹

| åœºæ™¯ | æ¨¡å‹ | ä½œç”¨ | ä¼˜åŠ¿ |
|------|------|------|------|
| å•†å“åˆ†ç±» | CLIP | é›¶æ ·æœ¬è¯†åˆ« | æ— éœ€è®­ç»ƒï¼Œå¿«é€Ÿä¸Šçº¿ |
| å•†å“åˆ†å‰² | SAM | å®ä¾‹åˆ†å‰² | é€šç”¨æ€§å¼ºï¼Œæ•ˆæœå¥½ |
| åœºæ™¯ç†è§£ | BLIP-2 | å›¾åƒæè¿° | ç†è§£å¤æ‚åœºæ™¯ |
| å•†å“æ£€æµ‹ | YOLO | ç›®æ ‡æ£€æµ‹ | é€Ÿåº¦å¿«ï¼Œå®æ—¶æ€§å¥½ |

---

## ğŸ’¡ æ ¸å¿ƒåŠŸèƒ½

### åŠŸèƒ½1ï¼šå•†å“è‡ªåŠ¨è¯†åˆ«

```python
# æ¨èæ–¹å¼ï¼šç›´æ¥ä½¿ç”¨å‘½ä»¤è¡Œè¿è¡Œ
# python code/05-applications/retail/product_recognizer.py \
#     --image product.jpg \
#     --database products.json \
#     --top-k 5

# å¦‚æœéœ€è¦åœ¨Pythonä»£ç ä¸­ä½¿ç”¨ï¼Œæ¨èä»¥ä¸‹æ–¹å¼ï¼š
import sys
import os

# æ·»åŠ é¡¹ç›®æ ¹ç›®å½•åˆ°Pythonè·¯å¾„
project_root = 'path/to/Large-Model-Tutorial'  # æ›¿æ¢ä¸ºå®é™…è·¯å¾„
sys.path.insert(0, project_root)

# ç”±äºç›®å½•ååŒ…å«è¿å­—ç¬¦ï¼Œä½¿ç”¨execåŠ è½½
module_path = os.path.join(project_root, 'code/05-applications/retail/product_recognizer.py')
with open(module_path, 'r', encoding='utf-8') as f:
    exec(f.read(), globals())

# ç°åœ¨å¯ä»¥ä½¿ç”¨ProductRecognizer
recognizer = ProductRecognizer(
    model_path="openai/clip-vit-base-patch32",
    product_database="products.json"
)

# è¯†åˆ«å•†å“
result = recognizer.recognize(
    image="product.jpg",
    top_k=5
)

# è®¿é—®ç»“æœ
print(f"è¯†åˆ«ç»“æœ: {result['best_match']['name']}")
print(f"ç½®ä¿¡åº¦: {result['best_match']['confidence']:.2%}")
print(f"SKU: {result['best_match']['sku']}")
```

**è¾“å‡ºç¤ºä¾‹**ï¼š
```json
{
  "best_match": {
    "name": "å¯å£å¯ä¹ 330ml",
    "confidence": 0.96,
    "sku": "SKU-001",
    "category": "é¥®æ–™",
    "brand": "å¯å£å¯ä¹",
    "price": 3.5
  },
  "recognized": true
}
```

### åŠŸèƒ½2ï¼šè´§æ¶æ»¡é™ˆç‡åˆ†æ

```python
# æ¨èæ–¹å¼ï¼šç›´æ¥ä½¿ç”¨å‘½ä»¤è¡Œè¿è¡Œ
# python code/05-applications/retail/shelf_analyzer.py \
#     --image shelf.jpg \
#     --expected å¯ä¹ é›ªç¢§ èŠ¬è¾¾ \  # æ”¯æŒç®€ç§°ï¼Œä¼šæ¨¡ç³ŠåŒ¹é…"å¯å£å¯ä¹ 330ml"ç­‰
#     --threshold 0.8 \
#     --visualize
#
# æ³¨æ„ï¼šexpected_products æ”¯æŒç®€ç§°åŒ¹é…
# - "å¯ä¹" å¯ä»¥åŒ¹é… "å¯å£å¯ä¹ 330ml"
# - "é›ªç¢§" å¯ä»¥åŒ¹é… "é›ªç¢§ 330ml"
# - æˆ–ä½¿ç”¨å®Œæ•´åç§°ï¼š"å¯å£å¯ä¹ 330ml" "é›ªç¢§ 330ml"

# å¦‚æœéœ€è¦åœ¨Pythonä»£ç ä¸­ä½¿ç”¨ï¼š
import sys
import os

project_root = 'path/to/Large-Model-Tutorial'  # æ›¿æ¢ä¸ºå®é™…è·¯å¾„
sys.path.insert(0, project_root)

# åŠ è½½product_recognizer
exec(open(os.path.join(project_root, 'code/05-applications/retail/product_recognizer.py'), 'r', encoding='utf-8').read(), globals())

# åŠ è½½shelf_analyzer
exec(open(os.path.join(project_root, 'code/05-applications/retail/shelf_analyzer.py'), 'r', encoding='utf-8').read(), globals())

# åˆå§‹åŒ–è¯†åˆ«å™¨ï¼ˆå¯é€‰ï¼‰
recognizer = ProductRecognizer()

# åˆå§‹åŒ–åˆ†æå™¨
analyzer = ShelfAnalyzer(
    product_recognizer=recognizer,
    fill_rate_threshold=0.8
)

# åˆ†æè´§æ¶
result = analyzer.analyze_shelf(
    image="shelf.jpg",
    expected_products=["å¯ä¹", "é›ªç¢§", "èŠ¬è¾¾"]
)

print(f"æ»¡é™ˆç‡: {result['fill_rate']:.1%}")
print(f"ç¼ºè´§å•†å“: {result['missing_products']}")
```

**è¾“å‡ºç¤ºä¾‹**ï¼š
```json
{
  "fill_rate": 0.85,
  "total_slots": 20,
  "filled_slots": 17,
  "empty_slots": 3,
  "missing_products": ["èŠ¬è¾¾"],
  "misplaced_products": [],
  "recommendations": ["è¡¥å……èŠ¬è¾¾åº“å­˜"]
}
```

### åŠŸèƒ½3ï¼šå®æ—¶ç›‘æ§ä¸é¢„è­¦

```python
# æ³¨æ„ï¼šRealtimeMonitor æ˜¯ç¤ºä¾‹æ¦‚å¿µï¼Œå®é™…ä»£ç ä¸­æš‚æœªå®ç°
# ä»¥ä¸‹æ˜¯åŸºäºç°æœ‰æ¨¡å—å®ç°çš„ç›‘æ§ç¤ºä¾‹

import sys
import os
import time

project_root = 'path/to/Large-Model-Tutorial'  # æ›¿æ¢ä¸ºå®é™…è·¯å¾„
sys.path.insert(0, project_root)

# åŠ è½½æ¨¡å—
exec(open(os.path.join(project_root, 'code/05-applications/retail/product_recognizer.py'), 'r', encoding='utf-8').read(), globals())
exec(open(os.path.join(project_root, 'code/05-applications/retail/shelf_analyzer.py'), 'r', encoding='utf-8').read(), globals())

# åˆå§‹åŒ–
recognizer = ProductRecognizer()
analyzer = ShelfAnalyzer(recognizer, fill_rate_threshold=0.8)

def monitor_shelf(image_source, check_interval=60):
    """
    ç®€å•çš„ç›‘æ§å¾ªç¯ç¤ºä¾‹
    
    Args:
        image_source: å›¾åƒæºï¼ˆå¯ä»¥æ˜¯æ‘„åƒå¤´æˆ–æ–‡ä»¶è·¯å¾„ï¼‰
        check_interval: æ£€æŸ¥é—´éš”ï¼ˆç§’ï¼‰
    """
    while True:
        # è·å–å›¾åƒï¼ˆå®é™…åº”ä»æ‘„åƒå¤´è·å–ï¼‰
        result = analyzer.analyze_shelf(image_source)
        
        print(f"å½“å‰æ»¡é™ˆç‡: {result['fill_rate']:.1%}")
        
        # æ£€æŸ¥æ˜¯å¦éœ€è¦å‘Šè­¦
        if result['alert']:
            print(f"âš ï¸ å‘Šè­¦ï¼šæ»¡é™ˆç‡ä½äºé˜ˆå€¼")
            print(f"å»ºè®®ï¼š{result['recommendations']}")
            # send_alert(result)  # å‘é€å‘Šè­¦
        
        time.sleep(check_interval)

# ä½¿ç”¨ç¤ºä¾‹
# monitor_shelf("shelf.jpg", check_interval=60)
```

---

## ğŸ› ï¸ å®ç°æ–¹æ¡ˆ

### æ–¹æ¡ˆ1ï¼šå•†å“è¯†åˆ«ç³»ç»Ÿ

#### ç³»ç»Ÿæµç¨‹

```
å›¾åƒè¾“å…¥ â†’ å›¾åƒé¢„å¤„ç† â†’ å•†å“åˆ†å‰² â†’ ç‰¹å¾æå– â†’ ç›¸ä¼¼åº¦åŒ¹é… â†’ ç»“æœè¾“å‡º
   â†“          â†“           â†“          â†“           â†“           â†“
 æ‘„åƒå¤´     è´¨é‡æ£€æŸ¥     SAM       CLIP      æ•°æ®åº“      JSON
```

#### æ ¸å¿ƒä»£ç 

```python
class ProductRecognizer:
    """å•†å“è¯†åˆ«å™¨"""
    
    def __init__(self, clip_model, sam_model, product_db):
        self.clip = CLIPModel.from_pretrained(clip_model)
        self.sam = SAMModel.from_pretrained(sam_model)
        self.products = self._load_products(product_db)
    
    def recognize(self, image):
        # 1. åˆ†å‰²å•†å“
        masks = self.sam.segment(image)
        
        # 2. æå–æ¯ä¸ªå•†å“çš„ç‰¹å¾
        features = []
        for mask in masks:
            product_img = self._crop_by_mask(image, mask)
            feature = self.clip.encode_image(product_img)
            features.append(feature)
        
        # 3. åŒ¹é…å•†å“åº“
        results = []
        for feature in features:
            best_match = self._find_best_match(feature)
            results.append(best_match)
        
        return results
    
    def _find_best_match(self, feature):
        """åœ¨å•†å“åº“ä¸­æ‰¾åˆ°æœ€ä½³åŒ¹é…"""
        max_similarity = 0
        best_product = None
        
        for product in self.products:
            similarity = cosine_similarity(feature, product['feature'])
            if similarity > max_similarity:
                max_similarity = similarity
                best_product = product
        
        return {
            'product': best_product,
            'confidence': max_similarity
        }
```

### æ–¹æ¡ˆ2ï¼šè´§æ¶é™ˆåˆ—åˆ†æ

#### åˆ†ææ­¥éª¤

1. **è´§æ¶åŒºåŸŸæ£€æµ‹**
   - ä½¿ç”¨SAMåˆ†å‰²è´§æ¶åŒºåŸŸ
   - è¯†åˆ«è´§æ¶å±‚çº§ç»“æ„

2. **å•†å“å®šä½**
   - æ£€æµ‹æ¯ä¸ªè´§ä½
   - è¯†åˆ«å•†å“ä½ç½®

3. **æ»¡é™ˆç‡è®¡ç®—**
   ```python
   fill_rate = filled_slots / total_slots
   ```

4. **å¼‚å¸¸æ£€æµ‹**
   - ç¼ºè´§æ£€æµ‹
   - é”™æ”¾æ£€æµ‹
   - è¿‡æœŸå•†å“æ£€æµ‹

#### å®ç°ç¤ºä¾‹

```python
class ShelfAnalyzer:
    """è´§æ¶åˆ†æå™¨"""
    
    def analyze_shelf(self, image, expected_products):
        # 1. åˆ†å‰²è´§æ¶
        shelf_mask = self._detect_shelf(image)
        shelf_img = self._crop_by_mask(image, shelf_mask)
        
        # 2. åˆ†å‰²å•†å“
        product_masks = self.sam.segment(shelf_img)
        
        # 3. è¯†åˆ«æ¯ä¸ªå•†å“
        detected_products = []
        for mask in product_masks:
            product = self._recognize_product(shelf_img, mask)
            detected_products.append(product)
        
        # 4. åˆ†æç»“æœ
        total_slots = self._count_total_slots(shelf_mask)
        filled_slots = len([p for p in detected_products if p])
        empty_slots = total_slots - filled_slots
        
        # 5. æ£€æŸ¥ç¼ºè´§
        missing = set(expected_products) - set([p['name'] for p in detected_products])
        
        return {
            'fill_rate': filled_slots / total_slots,
            'total_slots': total_slots,
            'filled_slots': filled_slots,
            'empty_slots': empty_slots,
            'missing_products': list(missing),
            'detected_products': detected_products
        }
```

---

## ğŸš€ éƒ¨ç½²æŒ‡å—

### ç¯å¢ƒå‡†å¤‡

```bash
# 1. åˆ›å»ºPythonç¯å¢ƒ
conda create -n retail python=3.8
conda activate retail

# 2. å®‰è£…ä¾èµ–
pip install torch torchvision
pip install transformers
pip install opencv-python pillow
pip install fastapi uvicorn
pip install redis mysql-connector-python

# 3. ä¸‹è½½æ¨¡å‹
python -c "from transformers import CLIPModel; CLIPModel.from_pretrained('openai/clip-vit-base-patch32')"
```

### ä½¿ç”¨ç°æœ‰ä»£ç 

> **âš ï¸ æ³¨æ„**ï¼šå½“å‰ç‰ˆæœ¬åªæä¾›äº†æ ¸å¿ƒåŠŸèƒ½æ¨¡å—ï¼ˆå•†å“è¯†åˆ«å’Œè´§æ¶åˆ†æï¼‰ã€‚
> FastAPIæœåŠ¡ç«¯ã€é…ç½®æ–‡ä»¶ç­‰å®Œæ•´éƒ¨ç½²æ–¹æ¡ˆè®¡åˆ’åœ¨åç»­ç‰ˆæœ¬å®ç°ã€‚

**å½“å‰å¯ç”¨çš„åŠŸèƒ½**ï¼š

```bash
# 1. å•†å“è¯†åˆ«
python code/05-applications/retail/product_recognizer.py \
    --image product.jpg \
    --database products.json \
    --top-k 5

# 2. è´§æ¶åˆ†æï¼ˆæ”¯æŒç®€ç§°åŒ¹é…ï¼‰
python code/05-applications/retail/shelf_analyzer.py \
    --image shelf.jpg \
    --expected å¯ä¹ é›ªç¢§ èŠ¬è¾¾ \
    --threshold 0.8 \
    --visualize

# æ³¨æ„ï¼šæœŸæœ›å•†å“åˆ—è¡¨æ”¯æŒç®€ç§°ï¼ˆå¦‚"å¯ä¹"ï¼‰æˆ–å®Œæ•´åç§°ï¼ˆå¦‚"å¯å£å¯ä¹ 330ml"ï¼‰
# åŒ¹é…æ–¹å¼ï¼šç®€ç§°ä¼šåœ¨å•†å“å…¨åä¸­è¿›è¡Œæ¨¡ç³ŠåŒ¹é…
```

### å®Œæ•´éƒ¨ç½²æ–¹æ¡ˆï¼ˆè§„åˆ’ä¸­ï¼‰

> **ğŸ“‹ çŠ¶æ€**ï¼šä»¥ä¸‹é…ç½®å’ŒæœåŠ¡ä»£ç è®¡åˆ’åœ¨P2é˜¶æ®µå®ç°

**é…ç½®æ–‡ä»¶ç¤ºä¾‹** `config.yaml`ï¼ˆå‚è€ƒï¼‰:
```yaml
# æ¨¡å‹é…ç½®
models:
  clip:
    model_name: "openai/clip-vit-base-patch32"
    device: "cuda"
    batch_size: 8

# ä¸šåŠ¡é…ç½®
business:
  fill_rate_threshold: 0.8
  confidence_threshold: 0.7
```

**FastAPIæœåŠ¡** `app.py`ï¼ˆè§„åˆ’ä¸­ï¼‰:
```python
# è®¡åˆ’å®ç°çš„APIæœåŠ¡
# from fastapi import FastAPI
# app = FastAPI()
# 
# @app.post("/api/recognize")
# async def recognize_product(image: UploadFile):
#     # å•†å“è¯†åˆ«æ¥å£
#     pass
```

### APIç¤ºä¾‹ï¼ˆè§„åˆ’ä¸­ï¼‰

> **âš ï¸ æ³¨æ„**ï¼šä»¥ä¸‹APIæ¥å£è®¡åˆ’åœ¨P2é˜¶æ®µå®ç°ï¼Œå½“å‰ç‰ˆæœ¬è¯·ä½¿ç”¨å‘½ä»¤è¡Œå·¥å…·

```bash
# å•†å“è¯†åˆ«ï¼ˆè§„åˆ’ä¸­ï¼‰
# curl -X POST "http://localhost:8000/api/recognize" \
#   -F "image=@product.jpg" \
#   -F "top_k=5"

# è´§æ¶åˆ†æï¼ˆè§„åˆ’ä¸­ï¼‰
# curl -X POST "http://localhost:8000/api/analyze_shelf" \
#   -F "image=@shelf.jpg" \
#   -F "expected_products=å¯ä¹,é›ªç¢§,èŠ¬è¾¾"

# å½“å‰å¯ç”¨ï¼šç›´æ¥ä½¿ç”¨å‘½ä»¤è¡Œå·¥å…·
python code/05-applications/retail/product_recognizer.py --image product.jpg
python code/05-applications/retail/shelf_analyzer.py --image shelf.jpg
```

---

## âš¡ æ€§èƒ½ä¼˜åŒ–

### 1. æ¨¡å‹ä¼˜åŒ–

**FP16æ··åˆç²¾åº¦**:
```python
# å‡å°‘æ˜¾å­˜å ç”¨ï¼Œæå‡æ¨ç†é€Ÿåº¦
model = model.half()  # FP16
```

**æ¨¡å‹é‡åŒ–**:
```python
# INT8é‡åŒ–ï¼Œè¿›ä¸€æ­¥æå‡æ€§èƒ½
from torch.quantization import quantize_dynamic
model = quantize_dynamic(model, {torch.nn.Linear}, dtype=torch.qint8)
```

**æ‰¹å¤„ç†**:
```python
# æ‰¹é‡å¤„ç†å›¾åƒï¼Œæå‡ååé‡
images = [img1, img2, img3, ...]
results = model(images, batch_size=8)
```

### 2. ç³»ç»Ÿä¼˜åŒ–

**ç¼“å­˜ç­–ç•¥**:
```python
# Redisç¼“å­˜å•†å“ç‰¹å¾
@cache(expire=3600)
def get_product_feature(product_id):
    return compute_feature(product_id)
```

**å¼‚æ­¥å¤„ç†**:
```python
# å¼‚æ­¥å¤„ç†å›¾åƒåˆ†æä»»åŠ¡
@app.post("/api/analyze_async")
async def analyze_async(image: UploadFile):
    task_id = queue.enqueue(analyze_image, image)
    return {"task_id": task_id}
```

**è´Ÿè½½å‡è¡¡**:
```nginx
# Nginxé…ç½®
upstream retail_api {
    server 127.0.0.1:8000;
    server 127.0.0.1:8001;
    server 127.0.0.1:8002;
}
```

### 3. æ€§èƒ½åŸºå‡†

| åœºæ™¯ | å»¶è¿Ÿ | ååé‡ | ç¡¬ä»¶ |
|------|------|--------|------|
| å•å•†å“è¯†åˆ« | 50ms | 20 img/s | V100 |
| è´§æ¶åˆ†æ | 200ms | 5 img/s | V100 |
| å®æ—¶ç›‘æ§ | 100ms | 10 fps | V100 |

---

## ğŸ“š æœ€ä½³å®è·µ

### 1. å•†å“åº“ç®¡ç†

**å•†å“ä¿¡æ¯ç»“æ„**:
```json
{
  "sku": "SKU-001234",
  "name": "å¯å£å¯ä¹ 330ml",
  "category": "é¥®æ–™",
  "brand": "å¯å£å¯ä¹",
  "price": 3.5,
  "images": [
    "product_front.jpg",
    "product_side.jpg",
    "product_top.jpg"
  ],
  "feature_vector": [0.1, 0.2, ...],
  "tags": ["ç¢³é…¸é¥®æ–™", "å†°é•‡", "å¤å­£"]
}
```

**ç‰¹å¾å‘é‡æ›´æ–°**:
```python
# å®šæœŸæ›´æ–°å•†å“ç‰¹å¾å‘é‡
def update_product_features():
    for product in products:
        images = load_product_images(product['sku'])
        features = [clip.encode_image(img) for img in images]
        product['feature_vector'] = np.mean(features, axis=0)
        save_product(product)
```

### 2. å¼‚å¸¸å¤„ç†

```python
# å¤„ç†è¯†åˆ«å¤±è´¥çš„æƒ…å†µ
def recognize_with_fallback(image):
    try:
        result = recognizer.recognize(image)
        if result['confidence'] < 0.7:
            # ç½®ä¿¡åº¦ä½ï¼Œä½¿ç”¨å¤‡ç”¨æ–¹æ¡ˆ
            result = manual_review_queue.add(image)
        return result
    except Exception as e:
        logger.error(f"è¯†åˆ«å¤±è´¥: {e}")
        return default_result
```

### 3. ç›‘æ§ä¸å‘Šè­¦

```python
# æ€§èƒ½ç›‘æ§
from prometheus_client import Counter, Histogram

recognition_counter = Counter('recognition_total', 'Total recognitions')
recognition_latency = Histogram('recognition_latency_seconds', 'Recognition latency')

@recognition_latency.time()
def recognize(image):
    recognition_counter.inc()
    return recognizer.recognize(image)
```

---

## ğŸ¯ å®é™…æ¡ˆä¾‹

### æ¡ˆä¾‹1ï¼šä¾¿åˆ©åº—æ™ºèƒ½è´§æ¶

**åœºæ™¯æè¿°**ï¼š
- 24å°æ—¶ä¾¿åˆ©åº—
- 50ä¸ªè´§æ¶ï¼Œ200+SKU
- éœ€è¦å®æ—¶ç›‘æ§æ»¡é™ˆç‡

**è§£å†³æ–¹æ¡ˆ**ï¼š
- æ¯ä¸ªè´§æ¶å®‰è£…1ä¸ªæ‘„åƒå¤´
- æ¯5åˆ†é’Ÿåˆ†æä¸€æ¬¡
- è‡ªåŠ¨ç”Ÿæˆè¡¥è´§å•

**æ•ˆæœ**ï¼š
- æ»¡é™ˆç‡ä» 75% æå‡åˆ° 92%
- ç¼ºè´§æ—¶é•¿å‡å°‘ 60%
- é”€å”®é¢æå‡ 18%

### æ¡ˆä¾‹2ï¼šè¶…å¸‚æ— äººæ”¶é“¶

**åœºæ™¯æè¿°**ï¼š
- å¤§å‹è¶…å¸‚è‡ªåŠ©æ”¶é“¶åŒº
- é«˜å³°æœŸæ’é˜Ÿä¸¥é‡
- éœ€è¦å¿«é€Ÿç»“ç®—

**è§£å†³æ–¹æ¡ˆ**ï¼š
- æ™ºèƒ½è´­ç‰©è½¦ + å•†å“è¯†åˆ«
- è‡ªåŠ¨æ‰«æå•†å“
- ç¦»åº—è‡ªåŠ¨ç»“ç®—

**æ•ˆæœ**ï¼š
- ç»“ç®—æ—¶é—´ä» 3åˆ†é’Ÿ ç¼©çŸ­åˆ° 30ç§’
- äººå·¥æˆæœ¬é™ä½ 70%
- é¡¾å®¢æ»¡æ„åº¦æå‡ 40%

---

## ğŸ“Š ROIåˆ†æ

### æˆæœ¬æ„æˆ

| é¡¹ç›® | é‡‘é¢ | è¯´æ˜ |
|------|------|------|
| ç¡¬ä»¶æˆæœ¬ | 10ä¸‡ | æ‘„åƒå¤´ã€æœåŠ¡å™¨ |
| è½¯ä»¶å¼€å‘ | 30ä¸‡ | å®šåˆ¶å¼€å‘ |
| è¿ç»´æˆæœ¬ | 5ä¸‡/å¹´ | äººå‘˜ã€ç”µè´¹ |
| **æ€»æŠ•å…¥** | **45ä¸‡** | é¦–å¹´ |

### æ”¶ç›Šåˆ†æ

| é¡¹ç›® | å¹´æ”¶ç›Š | è¯´æ˜ |
|------|--------|------|
| äººå·¥æˆæœ¬èŠ‚çœ | 40ä¸‡ | å‡å°‘5äºº |
| é”€å”®é¢æå‡ | 50ä¸‡ | æå‡10% |
| æŸè€—å‡å°‘ | 10ä¸‡ | å‡å°‘è¿‡æœŸã€é”™æ”¾ |
| **æ€»æ”¶ç›Š** | **100ä¸‡** | å¹´æ”¶ç›Š |

**ROI = (100 - 45) / 45 = 122%**

**å›æœ¬å‘¨æœŸ**: çº¦6ä¸ªæœˆ

---

## ğŸ”— ç›¸å…³èµ„æº

**å·²å®ç°ä»£ç **ï¼š
- [å•†å“è¯†åˆ«å™¨](../../code/05-applications/retail/product_recognizer.py)
- [è´§æ¶åˆ†æå™¨](../../code/05-applications/retail/shelf_analyzer.py)
- [ä½¿ç”¨è¯´æ˜](../../code/05-applications/retail/README.md)

**è§„åˆ’ä¸­**ï¼š
- APIæœåŠ¡ä»£ç ï¼ˆapp.pyï¼‰ - P2é˜¶æ®µå®ç°
- é…ç½®ç®¡ç†ï¼ˆconfig.yamlï¼‰ - P2é˜¶æ®µå®ç°

**ç›¸å…³æ–‡æ¡£**ï¼š
- [CLIPæ¨¡å‹è¯¦è§£](../01-æ¨¡å‹è°ƒç ”ä¸é€‰å‹/01-CLIPæ¨¡å‹è¯¦è§£.md)
- [SAMæ¨¡å‹è¯¦è§£](../01-æ¨¡å‹è°ƒç ”ä¸é€‰å‹/05-SAMæ¨¡å‹è¯¦è§£.md)

---

## ğŸ“ è®¸å¯

MIT License

