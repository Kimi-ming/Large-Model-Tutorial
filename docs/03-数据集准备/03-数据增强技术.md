# 03 - æ•°æ®å¢å¼ºæŠ€æœ¯

> ğŸ“š **å­¦ä¹ ç›®æ ‡**  
> - ç†è§£æ•°æ®å¢å¼ºçš„åŸç†å’Œä½œç”¨
> - æŒæ¡å¸¸ç”¨çš„æ•°æ®å¢å¼ºæ–¹æ³•
> - å­¦ä¼šé€‰æ‹©åˆé€‚çš„å¢å¼ºç­–ç•¥

> ğŸ¯ **å…ˆä¿®è¦æ±‚**  
> - å®Œæˆ [02-æ•°æ®é¢„å¤„ç†æ–¹æ³•](./02-æ•°æ®é¢„å¤„ç†æ–¹æ³•.md)
> - äº†è§£è¿‡æ‹Ÿåˆå’Œæ³›åŒ–çš„æ¦‚å¿µ

> â±ï¸ **é¢„è®¡å­¦ä¹ æ—¶é—´**: 30-45åˆ†é’Ÿ  
> ğŸ·ï¸ **éš¾åº¦**: â­â­â­â˜†â˜† ä¸­çº§

---

## ğŸ“– ç›®å½•

- [ä»€ä¹ˆæ˜¯æ•°æ®å¢å¼º](#ä»€ä¹ˆæ˜¯æ•°æ®å¢å¼º)
- [åŸºç¡€å›¾åƒå¢å¼º](#åŸºç¡€å›¾åƒå¢å¼º)
- [é«˜çº§å¢å¼ºæŠ€æœ¯](#é«˜çº§å¢å¼ºæŠ€æœ¯)
- [å¢å¼ºç­–ç•¥é€‰æ‹©](#å¢å¼ºç­–ç•¥é€‰æ‹©)
- [å®è·µç¤ºä¾‹](#å®è·µç¤ºä¾‹)

---

## ä»€ä¹ˆæ˜¯æ•°æ®å¢å¼º

### å®šä¹‰

**æ•°æ®å¢å¼ºï¼ˆData Augmentationï¼‰** æ˜¯é€šè¿‡å¯¹åŸå§‹æ•°æ®è¿›è¡Œéšæœºå˜æ¢ï¼Œç”Ÿæˆæ–°çš„è®­ç»ƒæ ·æœ¬çš„æŠ€æœ¯ã€‚

### ä½œç”¨

1. **æ‰©å……æ•°æ®é›†**: ä»æœ‰é™æ•°æ®ç”Ÿæˆæ›´å¤šæ ·æœ¬
2. **æå‡æ³›åŒ–èƒ½åŠ›**: å‡å°‘è¿‡æ‹Ÿåˆ
3. **å¢å¼ºé²æ£’æ€§**: æé«˜æ¨¡å‹å¯¹å˜æ¢çš„å®¹å¿åº¦

### åŸåˆ™

- âœ… ä¿æŒè¯­ä¹‰ä¸å˜ï¼ˆæ ‡ç­¾ä»ç„¶æ­£ç¡®ï¼‰
- âœ… å¢åŠ å¤šæ ·æ€§
- âœ… ç¬¦åˆçœŸå®åœºæ™¯

---

## åŸºç¡€å›¾åƒå¢å¼º

### 1. å‡ ä½•å˜æ¢

#### éšæœºè£å‰ªï¼ˆRandomCropï¼‰

```python
from torchvision import transforms

# éšæœºè£å‰ª224Ã—224åŒºåŸŸ
random_crop = transforms.RandomCrop(224)

# å¸¦paddingçš„éšæœºè£å‰ª
random_crop = transforms.RandomCrop(224, padding=4)
```

**é€‚ç”¨åœºæ™¯**: æ‰€æœ‰å›¾åƒåˆ†ç±»ä»»åŠ¡

#### éšæœºç¿»è½¬ï¼ˆRandomFlipï¼‰

```python
# æ°´å¹³ç¿»è½¬ï¼ˆæ¦‚ç‡50%ï¼‰
h_flip = transforms.RandomHorizontalFlip(p=0.5)

# å‚ç›´ç¿»è½¬
v_flip = transforms.RandomVerticalFlip(p=0.5)
```

**æ³¨æ„**: æŸäº›ä»»åŠ¡ä¸é€‚åˆç¿»è½¬ï¼ˆå¦‚æ–‡å­—è¯†åˆ«ï¼‰

#### éšæœºæ—‹è½¬ï¼ˆRandomRotationï¼‰

```python
# éšæœºæ—‹è½¬Â±15åº¦
rotation = transforms.RandomRotation(degrees=15)

# æŒ‡å®šæ—‹è½¬èŒƒå›´
rotation = transforms.RandomRotation(degrees=(-30, 30))
```

#### éšæœºç¼©æ”¾è£å‰ªï¼ˆRandomResizedCropï¼‰

```python
# æœ€å¸¸ç”¨çš„å¢å¼ºæ–¹æ³•
random_resized_crop = transforms.RandomResizedCrop(
    size=224,
    scale=(0.8, 1.0),  # è£å‰ªé¢ç§¯æ¯”ä¾‹
    ratio=(0.75, 1.33)  # å®½é«˜æ¯”èŒƒå›´
)
```

### 2. é¢œè‰²å˜æ¢

#### é¢œè‰²æŠ–åŠ¨ï¼ˆColorJitterï¼‰

```python
color_jitter = transforms.ColorJitter(
    brightness=0.2,  # äº®åº¦å˜åŒ–èŒƒå›´
    contrast=0.2,    # å¯¹æ¯”åº¦å˜åŒ–èŒƒå›´
    saturation=0.2,  # é¥±å’Œåº¦å˜åŒ–èŒƒå›´
    hue=0.1          # è‰²è°ƒå˜åŒ–èŒƒå›´
)
```

#### ç°åº¦åŒ–ï¼ˆRandomGrayscaleï¼‰

```python
# 10%æ¦‚ç‡è½¬ä¸ºç°åº¦å›¾
grayscale = transforms.RandomGrayscale(p=0.1)
```

### 3. å®Œæ•´çš„è®­ç»ƒå¢å¼ºæµæ°´çº¿

```python
train_transform = transforms.Compose([
    # å‡ ä½•å˜æ¢
    transforms.RandomResizedCrop(224, scale=(0.8, 1.0)),
    transforms.RandomHorizontalFlip(p=0.5),
    transforms.RandomRotation(degrees=15),
    
    # é¢œè‰²å˜æ¢
    transforms.ColorJitter(
        brightness=0.2,
        contrast=0.2,
        saturation=0.2,
        hue=0.1
    ),
    transforms.RandomGrayscale(p=0.1),
    
    # æ ‡å‡†é¢„å¤„ç†
    transforms.ToTensor(),
    transforms.Normalize(
        mean=[0.485, 0.456, 0.406],
        std=[0.229, 0.224, 0.225]
    ),
])
```

---

## é«˜çº§å¢å¼ºæŠ€æœ¯

### 1. RandAugment

**åŸç†**: ä»å¢å¼ºæ“ä½œæ± ä¸­éšæœºé€‰æ‹©Nä¸ªæ“ä½œï¼Œæ¯ä¸ªæ“ä½œä½¿ç”¨ç›¸åŒçš„å¼ºåº¦M

```python
from torchvision.transforms import RandAugment

# N=2: é€‰æ‹©2ä¸ªæ“ä½œ
# M=9: å¼ºåº¦ä¸º9ï¼ˆèŒƒå›´0-30ï¼‰
rand_augment = RandAugment(num_ops=2, magnitude=9)

transform = transforms.Compose([
    transforms.Resize(256),
    transforms.RandomCrop(224),
    rand_augment,  # åº”ç”¨RandAugment
    transforms.ToTensor(),
    transforms.Normalize(mean=[0.485, 0.456, 0.406],
                        std=[0.229, 0.224, 0.225]),
])
```

**ä¼˜ç‚¹**:
- âœ… è‡ªåŠ¨æœç´¢æœ€ä½³å¢å¼ºç­–ç•¥
- âœ… åªéœ€è°ƒæ•´2ä¸ªè¶…å‚æ•°ï¼ˆNå’ŒMï¼‰
- âœ… åœ¨å¤šä¸ªä»»åŠ¡ä¸Šè¡¨ç°ä¼˜å¼‚

### 2. Mixup

**åŸç†**: æ··åˆä¸¤ä¸ªæ ·æœ¬åŠå…¶æ ‡ç­¾

```python
def mixup_data(x, y, alpha=1.0):
    """Mixupæ•°æ®å¢å¼º"""
    if alpha > 0:
        lam = np.random.beta(alpha, alpha)
    else:
        lam = 1
    
    batch_size = x.size(0)
    index = torch.randperm(batch_size)
    
    mixed_x = lam * x + (1 - lam) * x[index, :]
    y_a, y_b = y, y[index]
    
    return mixed_x, y_a, y_b, lam

# è®­ç»ƒæ—¶ä½¿ç”¨
for images, labels in train_loader:
    images, labels_a, labels_b, lam = mixup_data(images, labels, alpha=1.0)
    
    outputs = model(images)
    loss = lam * criterion(outputs, labels_a) + \
           (1 - lam) * criterion(outputs, labels_b)
```

**æ•ˆæœ**: æå‡æ³›åŒ–èƒ½åŠ›ï¼Œå‡å°‘è¿‡æ‹Ÿåˆ

### 3. CutMix

**åŸç†**: è£å‰ªä¸€ä¸ªå›¾åƒçš„åŒºåŸŸï¼Œç²˜è´´åˆ°å¦ä¸€ä¸ªå›¾åƒä¸Š

```python
def cutmix_data(x, y, alpha=1.0):
    """CutMixæ•°æ®å¢å¼º"""
    lam = np.random.beta(alpha, alpha)
    batch_size = x.size(0)
    index = torch.randperm(batch_size)
    
    # è®¡ç®—è£å‰ªåŒºåŸŸ
    W, H = x.size(2), x.size(3)
    cut_rat = np.sqrt(1. - lam)
    cut_w = int(W * cut_rat)
    cut_h = int(H * cut_rat)
    
    cx = np.random.randint(W)
    cy = np.random.randint(H)
    
    bbx1 = np.clip(cx - cut_w // 2, 0, W)
    bby1 = np.clip(cy - cut_h // 2, 0, H)
    bbx2 = np.clip(cx + cut_w // 2, 0, W)
    bby2 = np.clip(cy + cut_h // 2, 0, H)
    
    # åº”ç”¨CutMix
    x[:, :, bbx1:bbx2, bby1:bby2] = x[index, :, bbx1:bbx2, bby1:bby2]
    
    # è°ƒæ•´lambda
    lam = 1 - ((bbx2 - bbx1) * (bby2 - bby1) / (W * H))
    
    return x, y, y[index], lam
```

---

## å¢å¼ºç­–ç•¥é€‰æ‹©

### æŒ‰ä»»åŠ¡ç±»å‹é€‰æ‹©

| ä»»åŠ¡ | æ¨èå¢å¼º | é¿å…ä½¿ç”¨ |
|------|---------|---------|
| **å›¾åƒåˆ†ç±»** | RandomResizedCrop, HFlip, ColorJitter | VFlipï¼ˆæŸäº›åœºæ™¯ï¼‰ |
| **ç›®æ ‡æ£€æµ‹** | RandomResize, HFlip, ColorJitter | å¼ºæ—‹è½¬ã€VFlip |
| **å›¾åƒåˆ†å‰²** | RandomCrop, HFlip, RandomScale | - |
| **ç»†ç²’åº¦åˆ†ç±»** | æ¸©å’Œçš„ColorJitter, å°è§’åº¦æ—‹è½¬ | å¼ºå˜æ¢ |

### æŒ‰æ•°æ®é‡é€‰æ‹©

**å°æ•°æ®é›†**ï¼ˆ<1Kæ ·æœ¬ï¼‰:
```python
# ä½¿ç”¨æ›´å¼ºçš„å¢å¼º
transform = transforms.Compose([
    transforms.RandomResizedCrop(224, scale=(0.6, 1.0)),  # æ›´å¤§èŒƒå›´
    transforms.RandomHorizontalFlip(),
    transforms.RandomRotation(30),  # æ›´å¤§è§’åº¦
    transforms.ColorJitter(0.4, 0.4, 0.4, 0.2),  # æ›´å¼ºå˜æ¢
    RandAugment(num_ops=3, magnitude=12),  # æ›´å¤šæ“ä½œ
    transforms.ToTensor(),
    transforms.Normalize(mean=[0.485, 0.456, 0.406],
                        std=[0.229, 0.224, 0.225]),
])
```

**å¤§æ•°æ®é›†**ï¼ˆ>100Kæ ·æœ¬ï¼‰:
```python
# ä½¿ç”¨æ¸©å’Œçš„å¢å¼º
transform = transforms.Compose([
    transforms.RandomResizedCrop(224),
    transforms.RandomHorizontalFlip(),
    transforms.ToTensor(),
    transforms.Normalize(mean=[0.485, 0.456, 0.406],
                        std=[0.229, 0.224, 0.225]),
])
```

---

## å®è·µç¤ºä¾‹

### ç¤ºä¾‹1: çŠ¬ç§åˆ†ç±»å¢å¼ºç­–ç•¥

```python
# é€‚åˆç»†ç²’åº¦åˆ†ç±»çš„å¢å¼º
dog_train_transform = transforms.Compose([
    # æ¸©å’Œçš„å‡ ä½•å˜æ¢ï¼ˆä¿ç•™ç»†èŠ‚ï¼‰
    transforms.Resize(256),
    transforms.RandomCrop(224),
    transforms.RandomHorizontalFlip(p=0.5),
    
    # æ¸©å’Œçš„é¢œè‰²å˜æ¢
    transforms.ColorJitter(
        brightness=0.1,
        contrast=0.1,
        saturation=0.1,
        hue=0.05
    ),
    
    transforms.ToTensor(),
    transforms.Normalize(
        mean=[0.485, 0.456, 0.406],
        std=[0.229, 0.224, 0.225]
    ),
])
```

### ç¤ºä¾‹2: ä½¿ç”¨Albumentationsåº“

```python
import albumentations as A
from albumentations.pytorch import ToTensorV2

# æ›´ä¸°å¯Œçš„å¢å¼ºé€‰é¡¹
transform = A.Compose([
    A.RandomResizedCrop(224, 224, scale=(0.8, 1.0)),
    A.HorizontalFlip(p=0.5),
    A.ShiftScaleRotate(
        shift_limit=0.1,
        scale_limit=0.1,
        rotate_limit=15,
        p=0.5
    ),
    A.OneOf([
        A.GaussNoise(p=1),
        A.GaussianBlur(p=1),
        A.MotionBlur(p=1),
    ], p=0.3),
    A.OneOf([
        A.OpticalDistortion(p=1),
        A.GridDistortion(p=1),
    ], p=0.2),
    A.Normalize(
        mean=[0.485, 0.456, 0.406],
        std=[0.229, 0.224, 0.225]
    ),
    ToTensorV2(),
])
```

---

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. æ¸è¿›å¼å¢å¼º

```python
# è®­ç»ƒåˆæœŸï¼šæ¸©å’Œå¢å¼º
early_transform = transforms.Compose([
    transforms.RandomResizedCrop(224, scale=(0.9, 1.0)),
    transforms.RandomHorizontalFlip(),
    transforms.ToTensor(),
    transforms.Normalize(mean=[0.485, 0.456, 0.406],
                        std=[0.229, 0.224, 0.225]),
])

# è®­ç»ƒåæœŸï¼šæ›´å¼ºå¢å¼º
late_transform = transforms.Compose([
    transforms.RandomResizedCrop(224, scale=(0.7, 1.0)),
    transforms.RandomHorizontalFlip(),
    transforms.ColorJitter(0.4, 0.4, 0.4, 0.2),
    RandAugment(num_ops=2, magnitude=9),
    transforms.ToTensor(),
    transforms.Normalize(mean=[0.485, 0.456, 0.406],
                        std=[0.229, 0.224, 0.225]),
])
```

### 2. éªŒè¯å¢å¼ºçš„æœ‰æ•ˆæ€§

```python
# å¯¹æ¯”ä¸åŒå¢å¼ºç­–ç•¥
augmentations = {
    'baseline': base_transform,
    'mild': mild_augment,
    'strong': strong_augment,
}

for name, transform in augmentations.items():
    dataset = MyDataset(data, transform=transform)
    # è®­ç»ƒå¹¶è®°å½•ç»“æœ
    accuracy = train_and_evaluate(dataset)
    print(f"{name}: {accuracy:.2f}%")
```

### 3. æ¨ç†æ—¶ä¸ä½¿ç”¨å¢å¼º

```python
# âŒ é”™è¯¯ï¼šæ¨ç†æ—¶ä½¿ç”¨å¢å¼º
val_transform = train_transform  # åŒ…å«éšæœºå¢å¼º

# âœ… æ­£ç¡®ï¼šæ¨ç†æ—¶ä½¿ç”¨ç¡®å®šæ€§é¢„å¤„ç†
val_transform = transforms.Compose([
    transforms.Resize(256),
    transforms.CenterCrop(224),  # ç¡®å®šæ€§è£å‰ª
    transforms.ToTensor(),
    transforms.Normalize(mean=[0.485, 0.456, 0.406],
                        std=[0.229, 0.224, 0.225]),
])
```

---

## â¡ï¸ ä¸‹ä¸€æ­¥

- [04-è‡ªå®šä¹‰æ•°æ®é›†åˆ¶ä½œ](./04-è‡ªå®šä¹‰æ•°æ®é›†åˆ¶ä½œ.md) - åˆ¶ä½œè‡ªå·±çš„æ•°æ®é›†
- [../02-æ¨¡å‹å¾®è°ƒæŠ€æœ¯/](../02-æ¨¡å‹å¾®è°ƒæŠ€æœ¯/) - åº”ç”¨æ•°æ®å¢å¼ºè¿›è¡Œè®­ç»ƒ

---

## ğŸ“š å‚è€ƒèµ„æº

- [RandAugmentè®ºæ–‡](https://arxiv.org/abs/1909.13719)
- [Mixupè®ºæ–‡](https://arxiv.org/abs/1710.09412)
- [CutMixè®ºæ–‡](https://arxiv.org/abs/1905.04899)
- [Albumentationsæ–‡æ¡£](https://albumentations.ai/)

